\hypertarget{cils__block__search_8cpp_source}{}\doxysection{cils\+\_\+block\+\_\+search.\+cpp}
\label{cils__block__search_8cpp_source}\index{src/source/cils\_block\_search.cpp@{src/source/cils\_block\_search.cpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 }
\DoxyCodeLine{00018 \textcolor{preprocessor}{\#include "\mbox{\hyperlink{cils__reduction_8cpp}{cils\_reduction.cpp}}"}}
\DoxyCodeLine{00019 \textcolor{preprocessor}{\#include "\mbox{\hyperlink{cils__ils__search_8cpp}{cils\_ils\_search.cpp}}"}}
\DoxyCodeLine{00020 \textcolor{preprocessor}{\#include <mpi.h>}}
\DoxyCodeLine{00021 }
\DoxyCodeLine{00022 \textcolor{keyword}{using namespace }std;}
\DoxyCodeLine{00023 }
\DoxyCodeLine{00024 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacecils}{cils}} \{}
\DoxyCodeLine{00025     \textcolor{keyword}{template}<\textcolor{keyword}{typename} scalar, \textcolor{keyword}{typename} index, index m, index n>}
\DoxyCodeLine{00026     returnType<scalar, index>}
\DoxyCodeLine{\Hypertarget{cils__block__search_8cpp_source_l00027}\mbox{\hyperlink{classcils_1_1cils_a43617a04926b844c063b47bbdee01f0a}{00027}}     \mbox{\hyperlink{classcils_1_1cils}{cils<scalar, index, m, n>::cils\_block\_search\_serial}}(\textcolor{keyword}{const} \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} init, \textcolor{keyword}{const} \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} *R\_R, \textcolor{keyword}{const} \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} *y\_r,}
\DoxyCodeLine{00028                                                         \textcolor{keyword}{const} vector<index> *d, vector<scalar> *z\_B) \{}
\DoxyCodeLine{00029 \textcolor{comment}{//    cils<scalar, index, m, n>::cils\_block\_search\_serial(const index init, const index size\_m, const index size\_n,}}
\DoxyCodeLine{00030 \textcolor{comment}{//                                                        const scalar *R\_R, const scalar *y\_r,}}
\DoxyCodeLine{00031 \textcolor{comment}{//                                                        const vector<index> *d, vector<scalar> *z\_B) \{}}
\DoxyCodeLine{00032 }
\DoxyCodeLine{00033         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} ds = d-\/>size(), n\_dx\_q\_0, n\_dx\_q\_1;}
\DoxyCodeLine{00034         array<scalar, n> y\_b;}
\DoxyCodeLine{00035         y\_b.fill(0);}
\DoxyCodeLine{00036         \textcolor{keywordflow}{if} (ds == \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}) \{}
\DoxyCodeLine{00037             \textcolor{comment}{//Find the Babai point}}
\DoxyCodeLine{00038             \textcolor{keywordflow}{return} cils\_babai\_search\_serial(z\_B);}
\DoxyCodeLine{00039         \}}
\DoxyCodeLine{00040 }
\DoxyCodeLine{00041         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} sum = 0;}
\DoxyCodeLine{00042         \mbox{\hyperlink{classcils_1_1cils__search}{cils\_search<scalar, index>}} ils(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}});}
\DoxyCodeLine{00043         \textcolor{comment}{//        cils\_search<scalar, index> ils(size\_m, size\_n, this-\/>qam);}}
\DoxyCodeLine{00044         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} start = omp\_get\_wtime();}
\DoxyCodeLine{00045 }
\DoxyCodeLine{00046         \textcolor{keywordflow}{if} (init == -\/1) \{}
\DoxyCodeLine{00047             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} i = 0; i < ds; i++) \{}
\DoxyCodeLine{00048                 n\_dx\_q\_1 = d-\/>at(i);}
\DoxyCodeLine{00049                 n\_dx\_q\_0 = i == ds -\/ 1 ? 0 : d-\/>at(i + 1);}
\DoxyCodeLine{00050 }
\DoxyCodeLine{00051                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} row = n\_dx\_q\_0; row < n\_dx\_q\_1; row++) \{}
\DoxyCodeLine{00052                     sum = 0;}
\DoxyCodeLine{00053                     \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} col = n\_dx\_q\_1; col < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; col++) \{}
\DoxyCodeLine{00054                         sum += R\_R[col * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} + row] * z\_B-\/>at(col);}
\DoxyCodeLine{00055                     \}}
\DoxyCodeLine{00056                     y\_b[row] = y\_r[row] -\/ sum;}
\DoxyCodeLine{00057                 \}}
\DoxyCodeLine{00058                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceplot__helper_a42a9284c68a72e08f1ba88f8fd2ac20d}{is\_constrained}})}
\DoxyCodeLine{00059                     ils.\mbox{\hyperlink{classcils_1_1cils__search_afbc108cdc3d8e1d47d3b2bb4513ce520}{obils\_search}}(n\_dx\_q\_0, n\_dx\_q\_1, 0, R\_R, y\_b, z\_B);}
\DoxyCodeLine{00060                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{00061                     ils.\mbox{\hyperlink{classcils_1_1cils__search_a441f70585541ce2098891ec6b59b466d}{ils\_search}}(n\_dx\_q\_0, n\_dx\_q\_1, 0, R\_R, y\_b, z\_B);}
\DoxyCodeLine{00062             \}}
\DoxyCodeLine{00063         \}}
\DoxyCodeLine{00064         start = omp\_get\_wtime() -\/ start;}
\DoxyCodeLine{00065 \textcolor{comment}{//        cils\_search<scalar, index, m,  n> ils(program\_def::k);}}
\DoxyCodeLine{00066 }
\DoxyCodeLine{00067         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} run\_time = omp\_get\_wtime();}
\DoxyCodeLine{00068 }
\DoxyCodeLine{00069         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} i = 0; i < ds; i++) \{}
\DoxyCodeLine{00070             n\_dx\_q\_1 = d-\/>at(i);}
\DoxyCodeLine{00071             n\_dx\_q\_0 = i == ds -\/ 1 ? 0 : d-\/>at(i + 1);}
\DoxyCodeLine{00072 }
\DoxyCodeLine{00073             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} row = n\_dx\_q\_0; row < n\_dx\_q\_1; row++) \{}
\DoxyCodeLine{00074                 sum = 0;}
\DoxyCodeLine{00075                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} col = n\_dx\_q\_1; col < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; col++) \{}
\DoxyCodeLine{00076                     sum += R\_R[col * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} + row] * z\_B-\/>at(col);}
\DoxyCodeLine{00077                 \}}
\DoxyCodeLine{00078                 y\_b[row] = y\_r[row] -\/ sum;}
\DoxyCodeLine{00079             \}}
\DoxyCodeLine{00080             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceplot__helper_a42a9284c68a72e08f1ba88f8fd2ac20d}{is\_constrained}})}
\DoxyCodeLine{00081                 ils.\mbox{\hyperlink{classcils_1_1cils__search_afbc108cdc3d8e1d47d3b2bb4513ce520}{obils\_search}}(n\_dx\_q\_0, n\_dx\_q\_1, 1, R\_R, y\_b, z\_B);}
\DoxyCodeLine{00082             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00083                 ils.\mbox{\hyperlink{classcils_1_1cils__search_a441f70585541ce2098891ec6b59b466d}{ils\_search}}(n\_dx\_q\_0, n\_dx\_q\_1, 1, R\_R, y\_b, z\_B);}
\DoxyCodeLine{00084         \}}
\DoxyCodeLine{00085 }
\DoxyCodeLine{00086         run\_time = omp\_get\_wtime() -\/ run\_time + start;}
\DoxyCodeLine{00087         \textcolor{comment}{//Matlab Partial Reduction needs to do the permutation}}
\DoxyCodeLine{00088         matrix\_vector\_mult<scalar, index, m, n>(Z, z\_B);}
\DoxyCodeLine{00089 }
\DoxyCodeLine{00090         \mbox{\hyperlink{structcils_1_1return_type}{returnType<scalar, index>}} reT = \{\{run\_time -\/ start\}, run\_time, 0\};}
\DoxyCodeLine{00091         \textcolor{keywordflow}{return} reT;}
\DoxyCodeLine{00092     \}}
\DoxyCodeLine{00093 }
\DoxyCodeLine{00094     \textcolor{keyword}{template}<\textcolor{keyword}{typename} scalar, \textcolor{keyword}{typename} index, index m, index n>}
\DoxyCodeLine{00095     \mbox{\hyperlink{structcils_1_1return_type}{returnType<scalar, index>}}}
\DoxyCodeLine{\Hypertarget{cils__block__search_8cpp_source_l00096}\mbox{\hyperlink{classcils_1_1cils_a406c5f15a5b09546976733be9ea804de}{00096}}     \mbox{\hyperlink{classcils_1_1cils}{cils<scalar, index, m, n>::cils\_block\_search\_serial\_CPUTEST}}(\textcolor{keyword}{const} \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} *R\_R, \textcolor{keyword}{const} \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} y\_r,}
\DoxyCodeLine{00097                                                                 \textcolor{keyword}{const} vector<index> *d, vector<scalar> *z\_B) \{}
\DoxyCodeLine{00098         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} ds = d-\/>size(), n\_dx\_q\_0, n\_dx\_q\_1;}
\DoxyCodeLine{00099         array<scalar, n> y\_b;}
\DoxyCodeLine{00100         y\_b.fill(0);}
\DoxyCodeLine{00101         vector<scalar> time(2 * ds, 0);}
\DoxyCodeLine{00102         \mbox{\hyperlink{classcils_1_1cils__search}{cils\_search<scalar, index>}} ils(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}});}
\DoxyCodeLine{00103         \textcolor{comment}{//special cases:}}
\DoxyCodeLine{00104         \textcolor{keywordflow}{if} (ds == 1) \{}
\DoxyCodeLine{00105             \textcolor{keywordflow}{if} (d-\/>at(0) == 1) \{}
\DoxyCodeLine{00106                 z\_B-\/>at(0) = round(y\_r[0] / R\_R[0]);}
\DoxyCodeLine{00107                 \textcolor{keywordflow}{return} \{\{\}, 0, 0\};}
\DoxyCodeLine{00108             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00109                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{00110                     y\_b[i] = y\_r[i];}
\DoxyCodeLine{00111                 \}}
\DoxyCodeLine{00112 \textcolor{comment}{//                if (is\_constrained)}}
\DoxyCodeLine{00113 \textcolor{comment}{//                    ils\_search\_obils(0, n, y\_b, z\_B);}}
\DoxyCodeLine{00114 \textcolor{comment}{//                else}}
\DoxyCodeLine{00115 \textcolor{comment}{//                    ils\_search(0, n, y\_b, z\_B);}}
\DoxyCodeLine{00116                 \textcolor{keywordflow}{return} \{\{\}, 0, 0\};}
\DoxyCodeLine{00117             \}}
\DoxyCodeLine{00118         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ds == \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}) \{}
\DoxyCodeLine{00119             \textcolor{comment}{//Find the Babai point}}
\DoxyCodeLine{00120             \textcolor{keywordflow}{return} cils\_babai\_search\_serial(z\_B);}
\DoxyCodeLine{00121         \}}
\DoxyCodeLine{00122 }
\DoxyCodeLine{00123         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} i = 0; i < ds; i++) \{}
\DoxyCodeLine{00124             n\_dx\_q\_1 = d-\/>at(i);}
\DoxyCodeLine{00125             n\_dx\_q\_0 = i == ds -\/ 1 ? 0 : d-\/>at(i + 1);}
\DoxyCodeLine{00126 }
\DoxyCodeLine{00127             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} row = n\_dx\_q\_0; row < n\_dx\_q\_1; row++) \{}
\DoxyCodeLine{00128                 \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} sum = 0;}
\DoxyCodeLine{00129                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} col = n\_dx\_q\_1; col < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; col++) \{}
\DoxyCodeLine{00130                     sum += R\_R[col * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} + row] * z\_B-\/>at(col);}
\DoxyCodeLine{00131                 \}}
\DoxyCodeLine{00132                 y\_b[row] = y\_r[row] -\/ sum;}
\DoxyCodeLine{00133             \}}
\DoxyCodeLine{00134         \}}
\DoxyCodeLine{00135 \textcolor{comment}{//        std::random\_shuffle(r\_d.begin(), r\_d.end());}}
\DoxyCodeLine{00136 }
\DoxyCodeLine{00137         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} start = omp\_get\_wtime();}
\DoxyCodeLine{00138         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} i = 0; i < ds; i++) \{}
\DoxyCodeLine{00139             n\_dx\_q\_1 = d-\/>at(i);}
\DoxyCodeLine{00140             n\_dx\_q\_0 = i == ds -\/ 1 ? 0 : d-\/>at(i + 1);}
\DoxyCodeLine{00141             \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} time\_index = i;}
\DoxyCodeLine{00142 }
\DoxyCodeLine{00143             time[time\_index] = omp\_get\_wtime();}
\DoxyCodeLine{00144             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceplot__helper_a42a9284c68a72e08f1ba88f8fd2ac20d}{is\_constrained}})}
\DoxyCodeLine{00145                 time[time\_index + ds] = ils.\mbox{\hyperlink{classcils_1_1cils__search_afbc108cdc3d8e1d47d3b2bb4513ce520}{obils\_search}}(n\_dx\_q\_0, n\_dx\_q\_1, 1, R\_R, y\_b, z\_B);}
\DoxyCodeLine{00146             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00147                 time[time\_index + ds] = ils.\mbox{\hyperlink{classcils_1_1cils__search_a441f70585541ce2098891ec6b59b466d}{ils\_search}}(n\_dx\_q\_0, n\_dx\_q\_1, 1, R\_R, y\_b, z\_B);}
\DoxyCodeLine{00148 }
\DoxyCodeLine{00149             time[time\_index] = omp\_get\_wtime() -\/ time[time\_index];}
\DoxyCodeLine{00150         \}}
\DoxyCodeLine{00151 }
\DoxyCodeLine{00152         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} run\_time = omp\_get\_wtime() -\/ start;}
\DoxyCodeLine{00153 }
\DoxyCodeLine{00154 \textcolor{comment}{//        for (index i = 0; i < ds; i++) \{}}
\DoxyCodeLine{00155 \textcolor{comment}{//            printf("\%.5f,", time[i]);}}
\DoxyCodeLine{00156 \textcolor{comment}{//        \}}}
\DoxyCodeLine{00157 }
\DoxyCodeLine{00158         \textcolor{comment}{//Matlab Partial Reduction needs to do the permutation}}
\DoxyCodeLine{00159         matrix\_vector\_mult<scalar, index, m, n>(Z, z\_B);}
\DoxyCodeLine{00160 }
\DoxyCodeLine{00161         \mbox{\hyperlink{structcils_1_1return_type}{returnType<scalar, index>}} reT = \{time, run\_time, 0\};}
\DoxyCodeLine{00162         \textcolor{keywordflow}{return} reT;}
\DoxyCodeLine{00163     \}}
\DoxyCodeLine{00164 }
\DoxyCodeLine{00165     \textcolor{keyword}{template}<\textcolor{keyword}{typename} scalar, \textcolor{keyword}{typename} index, index m, index n>}
\DoxyCodeLine{00166     \mbox{\hyperlink{structcils_1_1return_type}{returnType<scalar, index>}}}
\DoxyCodeLine{\Hypertarget{cils__block__search_8cpp_source_l00167}\mbox{\hyperlink{classcils_1_1cils_a99bcdc878c2f7c06ef605b5654852a26}{00167}}     \mbox{\hyperlink{classcils_1_1cils}{cils<scalar, index, m, n>::cils\_block\_search\_omp}}(\textcolor{keyword}{const} \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} n\_proc, \textcolor{keyword}{const} \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} nswp, \textcolor{keyword}{const} \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} init,}
\DoxyCodeLine{00168                                                      \textcolor{keyword}{const} \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} *y\_r, \textcolor{keyword}{const} vector<index> *d, vector<scalar> *z\_B) \{}
\DoxyCodeLine{00169         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} ds = d-\/>size();}
\DoxyCodeLine{00170         \textcolor{keywordflow}{if} (ds == 1 || ds == \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}) \{}
\DoxyCodeLine{00171             \textcolor{keywordflow}{return} cils\_block\_search\_serial(init, d, z\_B);}
\DoxyCodeLine{00172         \}}
\DoxyCodeLine{00173 }
\DoxyCodeLine{00174         \textcolor{keyword}{auto} z\_x = z\_B-\/>data();}
\DoxyCodeLine{00175         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} diff = 0, num\_iter = 0, flag = 0, temp, R\_S\_1[ds] = \{\}, R\_S\_2[ds] = \{\};}
\DoxyCodeLine{00176         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} test, row\_n, check = 0, r, \_nswp = nswp, end = 0;}
\DoxyCodeLine{00177         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} n\_dx\_q\_2, n\_dx\_q\_1, n\_dx\_q\_0;}
\DoxyCodeLine{00178         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} sum = 0, start;}
\DoxyCodeLine{00179         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} run\_time = 0, run\_time3 = 0;}
\DoxyCodeLine{00180 }
\DoxyCodeLine{00181         array<scalar, n> y\_B;}
\DoxyCodeLine{00182         y\_B.fill(0);}
\DoxyCodeLine{00183         \mbox{\hyperlink{classcils_1_1cils__search}{cils\_search<scalar, index>}} \_ils(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}});}
\DoxyCodeLine{00184         omp\_set\_schedule((omp\_sched\_t) \mbox{\hyperlink{namespacecils_1_1program__def_a5317e618a5bb00f0cd69b6b3b5c9c72a}{schedule}}, \mbox{\hyperlink{namespacecils_1_1program__def_aa0d284cb0d13f48463cb69dc837bdf9b}{chunk\_size}});}
\DoxyCodeLine{00185         \textcolor{keyword}{auto} lock = \textcolor{keyword}{new} omp\_lock\_t[ds]();}
\DoxyCodeLine{00186         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} i = 0; i < ds; i++) \{}
\DoxyCodeLine{00187             omp\_set\_lock(\&lock[i]);}
\DoxyCodeLine{00188         \}}
\DoxyCodeLine{00189 }
\DoxyCodeLine{00190         omp\_unset\_lock(\&lock[0]);}
\DoxyCodeLine{00191         omp\_unset\_lock(\&lock[1]);}
\DoxyCodeLine{00192 }
\DoxyCodeLine{00193 }
\DoxyCodeLine{00194 \textcolor{preprocessor}{\#pragma omp parallel default(none) num\_threads(n\_proc)}}
\DoxyCodeLine{00195         \{\}}
\DoxyCodeLine{00196         \textcolor{keywordflow}{if} (init == -\/1) \{}
\DoxyCodeLine{00197             start = omp\_get\_wtime();}
\DoxyCodeLine{00198             n\_dx\_q\_2 = d-\/>at(0);}
\DoxyCodeLine{00199             n\_dx\_q\_0 = d-\/>at(1);}
\DoxyCodeLine{00200 }
\DoxyCodeLine{00201             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceplot__helper_a42a9284c68a72e08f1ba88f8fd2ac20d}{program\_def::is\_constrained}})}
\DoxyCodeLine{00202                 \_ils.\mbox{\hyperlink{classcils_1_1cils__search_a30a32f5f1ac4a2dba1ffb4f710371567}{obils\_search\_omp}}(n\_dx\_q\_0, n\_dx\_q\_2, 0, 0, R\_A, y\_r, z\_x);}
\DoxyCodeLine{00203             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00204                 \_ils.\mbox{\hyperlink{classcils_1_1cils__search_a64f9d7903096e9c34b6d83f2164715ad}{ils\_search\_omp}}(n\_dx\_q\_0, n\_dx\_q\_2, 0, 0, R\_A, y\_r, z\_x);}
\DoxyCodeLine{00205 }
\DoxyCodeLine{00206             R\_S\_2[0] = 1;}
\DoxyCodeLine{00207             end = 1;}
\DoxyCodeLine{00208 \textcolor{preprocessor}{\#pragma omp parallel default(shared) num\_threads(n\_proc) private(n\_dx\_q\_2, n\_dx\_q\_1, n\_dx\_q\_0, sum, temp, check, test, row\_n)}}
\DoxyCodeLine{00209             \{}
\DoxyCodeLine{00210                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} j = 0; j < \_nswp \&\& !flag; j++) \{}
\DoxyCodeLine{00211 \textcolor{preprocessor}{\#pragma omp for schedule(dynamic) nowait}}
\DoxyCodeLine{00212                     \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} i = 1; i < ds; i++) \{}
\DoxyCodeLine{00213                         \textcolor{keywordflow}{if} (!flag \&\& end <= i) \{\textcolor{comment}{// !R\_S\_1[i] \&\& front >= i \&\&!R\_S\_1[i] \&\&}}
\DoxyCodeLine{00214                             n\_dx\_q\_2 = d-\/>at(i);}
\DoxyCodeLine{00215                             n\_dx\_q\_0 = i == ds -\/ 1 ? 0 : d-\/>at(i + 1);}
\DoxyCodeLine{00216                             check = i == end;}
\DoxyCodeLine{00217                             row\_n = (n\_dx\_q\_0 -\/ 1) * (\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} -\/ n\_dx\_q\_0 / 2);}
\DoxyCodeLine{00218                             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} row = n\_dx\_q\_0; row < n\_dx\_q\_2; row++) \{}
\DoxyCodeLine{00219                                 sum = 0;}
\DoxyCodeLine{00220                                 row\_n += \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} -\/ row;}
\DoxyCodeLine{00221                                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} col = n\_dx\_q\_2; col < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; col++) \{}
\DoxyCodeLine{00222                                     sum += R\_A[col + row\_n] * z\_x[col];}
\DoxyCodeLine{00223                                 \}}
\DoxyCodeLine{00224                                 y\_B[row] = y\_r[row] -\/ sum;}
\DoxyCodeLine{00225                             \}}
\DoxyCodeLine{00226                             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceplot__helper_a42a9284c68a72e08f1ba88f8fd2ac20d}{program\_def::is\_constrained}})}
\DoxyCodeLine{00227                                 R\_S\_2[i] = \_ils.\mbox{\hyperlink{classcils_1_1cils__search_a30a32f5f1ac4a2dba1ffb4f710371567}{obils\_search\_omp}}(n\_dx\_q\_0, n\_dx\_q\_2, i, 0, R\_A, y\_B, z\_x);}
\DoxyCodeLine{00228                             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00229                                 R\_S\_2[i] = \_ils.\mbox{\hyperlink{classcils_1_1cils__search_a64f9d7903096e9c34b6d83f2164715ad}{ils\_search\_omp}}(n\_dx\_q\_0, n\_dx\_q\_2, i, 0, R\_A, y\_B, z\_x);}
\DoxyCodeLine{00230                             \textcolor{keywordflow}{if} (check) \{}
\DoxyCodeLine{00231                                 end = i + 1;}
\DoxyCodeLine{00232                                 R\_S\_2[i] = 1;}
\DoxyCodeLine{00233                             \}}
\DoxyCodeLine{00234                             diff += R\_S\_2[i];}
\DoxyCodeLine{00235                             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}} != 0) \{}
\DoxyCodeLine{00236                                 flag = ((diff) >= ds -\/ 1) \&\& j > 0;}
\DoxyCodeLine{00237                             \}}
\DoxyCodeLine{00238                         \}}
\DoxyCodeLine{00239                     \}}
\DoxyCodeLine{00240                 \}}
\DoxyCodeLine{00241 \textcolor{preprocessor}{\#pragma omp single}}
\DoxyCodeLine{00242                 \{}
\DoxyCodeLine{00243                     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}} != 1) run\_time = omp\_get\_wtime() -\/ start;}
\DoxyCodeLine{00244                 \};}
\DoxyCodeLine{00245             \}}
\DoxyCodeLine{00246             \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}} == 1) run\_time = omp\_get\_wtime() -\/ start;}
\DoxyCodeLine{00247             flag = check = diff = 0;}
\DoxyCodeLine{00248             \_nswp = 3;}
\DoxyCodeLine{00249         \}}
\DoxyCodeLine{00250 }
\DoxyCodeLine{00251         \mbox{\hyperlink{classcils_1_1cils__search}{cils\_search<scalar, index>}} ils(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}});}
\DoxyCodeLine{00252         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} run\_time2 = omp\_get\_wtime();}
\DoxyCodeLine{00253         n\_dx\_q\_2 = d-\/>at(0);}
\DoxyCodeLine{00254         n\_dx\_q\_0 = d-\/>at(1);}
\DoxyCodeLine{00255 }
\DoxyCodeLine{00256         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceplot__helper_a42a9284c68a72e08f1ba88f8fd2ac20d}{program\_def::is\_constrained}})}
\DoxyCodeLine{00257             ils.\mbox{\hyperlink{classcils_1_1cils__search_a30a32f5f1ac4a2dba1ffb4f710371567}{obils\_search\_omp}}(n\_dx\_q\_0, n\_dx\_q\_2, 0, 1, R\_A, y\_r, z\_x);}
\DoxyCodeLine{00258         \textcolor{keywordflow}{else}}
\DoxyCodeLine{00259             ils.\mbox{\hyperlink{classcils_1_1cils__search_a64f9d7903096e9c34b6d83f2164715ad}{ils\_search\_omp}}(n\_dx\_q\_0, n\_dx\_q\_2, 0, 1, R\_A, y\_r, z\_x);}
\DoxyCodeLine{00260 }
\DoxyCodeLine{00261 }
\DoxyCodeLine{00262         R\_S\_1[0] = 1;}
\DoxyCodeLine{00263         end = 1;}
\DoxyCodeLine{00264 }
\DoxyCodeLine{00265 \textcolor{preprocessor}{\#pragma omp parallel default(shared) num\_threads(n\_proc) private(n\_dx\_q\_2, n\_dx\_q\_1, n\_dx\_q\_0, sum, temp, check, test, row\_n)}}
\DoxyCodeLine{00266         \{}
\DoxyCodeLine{00267 }
\DoxyCodeLine{00268             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} j = 0; j < \_nswp \&\& !flag; j++) \{}
\DoxyCodeLine{00269 \textcolor{comment}{//                omp\_set\_lock(\&lock[j -\/ 1]);}}
\DoxyCodeLine{00270 \textcolor{comment}{//                omp\_unset\_lock(\&lock[j -\/ 1]);}}
\DoxyCodeLine{00271 \textcolor{preprocessor}{\#pragma omp for schedule(runtime) nowait}}
\DoxyCodeLine{00272                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} i = 1; i < ds; i++) \{}
\DoxyCodeLine{00273                     \textcolor{keywordflow}{if} (!flag \&\& end <= i) \{\textcolor{comment}{//  front >= i   \&\&}}
\DoxyCodeLine{00274                         n\_dx\_q\_2 = d-\/>at(i);}
\DoxyCodeLine{00275                         n\_dx\_q\_0 = i == ds -\/ 1 ? 0 : d-\/>at(i + 1);}
\DoxyCodeLine{00276                         check = i == end;}
\DoxyCodeLine{00277                         row\_n = (n\_dx\_q\_0 -\/ 1) * (\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} -\/ n\_dx\_q\_0 / 2);}
\DoxyCodeLine{00278                         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} row = n\_dx\_q\_0; row < n\_dx\_q\_2; row++) \{}
\DoxyCodeLine{00279                             sum = 0;}
\DoxyCodeLine{00280                             row\_n += \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} -\/ row;}
\DoxyCodeLine{00281 \textcolor{preprocessor}{\#pragma omp simd reduction(+:sum)}}
\DoxyCodeLine{00282                             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} col = n\_dx\_q\_2; col < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; col++) \{}
\DoxyCodeLine{00283                                 sum += R\_A[col + row\_n] * z\_x[col];}
\DoxyCodeLine{00284                             \}}
\DoxyCodeLine{00285                             y\_B[row] = y\_r[row] -\/ sum;}
\DoxyCodeLine{00286                         \}}
\DoxyCodeLine{00287 \textcolor{comment}{//                        test = 0;}}
\DoxyCodeLine{00288 \textcolor{comment}{//                        for (index row = 0; row < i; row++)\{}}
\DoxyCodeLine{00289 \textcolor{comment}{//                            test += R\_S\_1[i];}}
\DoxyCodeLine{00290 \textcolor{comment}{//                        \}}}
\DoxyCodeLine{00291 \textcolor{comment}{//                        omp\_set\_lock(\&lock[i -\/ 1]);}}
\DoxyCodeLine{00292 }
\DoxyCodeLine{00293 \textcolor{comment}{//                        check = check || R\_S\_1[i -\/ 1];}}
\DoxyCodeLine{00294                         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceplot__helper_a42a9284c68a72e08f1ba88f8fd2ac20d}{program\_def::is\_constrained}})}
\DoxyCodeLine{00295                             R\_S\_1[i] = ils.\mbox{\hyperlink{classcils_1_1cils__search_a30a32f5f1ac4a2dba1ffb4f710371567}{obils\_search\_omp}}(n\_dx\_q\_0, n\_dx\_q\_2, i, check, R\_A, y\_B, z\_x);}
\DoxyCodeLine{00296                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{00297                             R\_S\_1[i] = ils.\mbox{\hyperlink{classcils_1_1cils__search_a64f9d7903096e9c34b6d83f2164715ad}{ils\_search\_omp}}(n\_dx\_q\_0, n\_dx\_q\_2, i, check, R\_A, y\_B, z\_x);}
\DoxyCodeLine{00298                         omp\_unset\_lock(\&lock[j]);}
\DoxyCodeLine{00299                         \textcolor{keywordflow}{if} (check) \{ }
\DoxyCodeLine{00300                             end = i + 1;}
\DoxyCodeLine{00301                             R\_S\_1[i] = 1;}
\DoxyCodeLine{00302                         \}}
\DoxyCodeLine{00303 \textcolor{preprocessor}{\#pragma omp atomic}}
\DoxyCodeLine{00304                         diff += R\_S\_1[i];}
\DoxyCodeLine{00305                         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}} != 0) \{}
\DoxyCodeLine{00306                             flag = ((diff) >= ds -\/ \mbox{\hyperlink{namespacecils_1_1program__def_abbc3bbdcc623be9d3c0e11f108526404}{stop}}) \&\& j > 0;}
\DoxyCodeLine{00307                         \}}
\DoxyCodeLine{00308                     \}}
\DoxyCodeLine{00309                     num\_iter = j;}
\DoxyCodeLine{00310 }
\DoxyCodeLine{00311                 \}}
\DoxyCodeLine{00312             \}}
\DoxyCodeLine{00313 }
\DoxyCodeLine{00314 \textcolor{preprocessor}{\#pragma omp single}}
\DoxyCodeLine{00315             \{}
\DoxyCodeLine{00316                 run\_time3 = omp\_get\_wtime() -\/ run\_time2;}
\DoxyCodeLine{00317             \}}
\DoxyCodeLine{00318 \textcolor{comment}{//\#pragma omp flush}}
\DoxyCodeLine{00319         \}}
\DoxyCodeLine{00320         run\_time2 = omp\_get\_wtime() -\/ run\_time2;}
\DoxyCodeLine{00321 \textcolor{preprocessor}{\#pragma parallel omp cancellation point}}
\DoxyCodeLine{00322 }
\DoxyCodeLine{00323         \mbox{\hyperlink{structcils_1_1return_type}{returnType<scalar, index>}} reT;}
\DoxyCodeLine{00324         matrix\_vector\_mult<scalar, index, m, n>(Z, z\_B);}
\DoxyCodeLine{00325 }
\DoxyCodeLine{00326         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} time = 0; \textcolor{comment}{//(run\_time3 + run\_time2) * 0.5;}}
\DoxyCodeLine{00327         \textcolor{keywordflow}{if} (init == -\/1) \{}
\DoxyCodeLine{00328             time = this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}} == 1 ? run\_time2 + run\_time : run\_time2 + run\_time;}
\DoxyCodeLine{00329         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00330             time = this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}} == 1 ? run\_time2 : run\_time2 * 0.5 + run\_time3 * 0.5;}
\DoxyCodeLine{00331         \}}
\DoxyCodeLine{00332         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}} == 0)}
\DoxyCodeLine{00333             reT = \{\{run\_time3\}, time, (\mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}}) diff + end\};}
\DoxyCodeLine{00334         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00335             reT = \{\{run\_time3\}, time, (\mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}}) num\_iter + 1\};}
\DoxyCodeLine{00336 \textcolor{comment}{//            cout << "n\_proc:" << n\_proc << "," << "init:" << init << "," << diff << "," << end << ",Ratio:"}}
\DoxyCodeLine{00337 \textcolor{comment}{//                 << (index) (run\_time2 / run\_time3) << "," << run\_time << "||";}}
\DoxyCodeLine{00338 \textcolor{comment}{//            cout.flush();}}
\DoxyCodeLine{00339         \}}
\DoxyCodeLine{00340         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} i = 0; i < ds; i++) \{}
\DoxyCodeLine{00341             omp\_destroy\_lock(\&lock[i]);}
\DoxyCodeLine{00342         \}}
\DoxyCodeLine{00343         \textcolor{keywordflow}{return} reT;}
\DoxyCodeLine{00344     \}}
\DoxyCodeLine{00345 }
\DoxyCodeLine{00346 }
\DoxyCodeLine{00347     \textcolor{keyword}{template}<\textcolor{keyword}{typename} scalar, \textcolor{keyword}{typename} index, index m, index n>}
\DoxyCodeLine{00348     \mbox{\hyperlink{structcils_1_1return_type}{returnType<scalar, index>}}}
\DoxyCodeLine{\Hypertarget{cils__block__search_8cpp_source_l00349}\mbox{\hyperlink{classcils_1_1cils_ad430b7313ce137f2308b08511753bc37}{00349}}     \mbox{\hyperlink{classcils_1_1cils}{cils<scalar, index, m, n>::cils\_scp\_block\_optimal\_serial}}(vector<scalar> \&x\_cur, \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_norm\_cur, \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} \mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}}) \{}
\DoxyCodeLine{00350         vector<scalar> H\_A, x\_tmp(x\_cur), x\_per(x\_cur), y\_bar(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0), y(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{00351         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:24' stopping=zeros(1,3);}}
\DoxyCodeLine{00352         vector<scalar> stopping(3, 0);}
\DoxyCodeLine{00353         array<scalar, m * n> H\_P(H);\textcolor{comment}{//, H\_H(H);}}
\DoxyCodeLine{00354 }
\DoxyCodeLine{00355         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:44' P\_tmp = eye(n);}}
\DoxyCodeLine{00356 }
\DoxyCodeLine{00357 \textcolor{comment}{//        helper::eye<scalar, index>(n, P\_cur.data());}}
\DoxyCodeLine{00358 \textcolor{comment}{//        helper::eye<scalar, index>(n, I.data());}}
\DoxyCodeLine{00359 }
\DoxyCodeLine{00360         vector<scalar> z(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), z\_z(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0); \textcolor{comment}{//z\_z = Z * z;}}
\DoxyCodeLine{00361         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{00362             helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, H\_P.data(), \textcolor{stringliteral}{"H"});}
\DoxyCodeLine{00363             helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 1, x\_tmp.data(), \textcolor{stringliteral}{"x\_tmp"});}
\DoxyCodeLine{00364         \}}
\DoxyCodeLine{00365         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} time = omp\_get\_wtime();}
\DoxyCodeLine{00366         \textcolor{comment}{//  Subfunctions: SCP\_opt}}
\DoxyCodeLine{00367 }
\DoxyCodeLine{00368         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:25' b\_count = 0;}}
\DoxyCodeLine{00369         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} b\_count = 0;}
\DoxyCodeLine{00370         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:27' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{00371         \textcolor{keywordflow}{if} (v\_norm\_cur <= tolerance) \{}
\DoxyCodeLine{00372             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:28' stopping(1)=1;}}
\DoxyCodeLine{00373             stopping[0] = 1;}
\DoxyCodeLine{00374             time = omp\_get\_wtime() -\/ time;}
\DoxyCodeLine{00375             \textcolor{keywordflow}{return} \{stopping, time, v\_norm\_cur\};}
\DoxyCodeLine{00376         \}}
\DoxyCodeLine{00377         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} cur\_1st, cur\_end, i, t, k1, per = -\/1, best\_per = -\/1;}
\DoxyCodeLine{00378         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:32' q = ceil(n/m);}}
\DoxyCodeLine{00379         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:33' indicator = zeros(2, q);}}
\DoxyCodeLine{00380         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:47' H\_P = H\_C;}}
\DoxyCodeLine{00381         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:48' x\_tmp = x\_cur;}}
\DoxyCodeLine{00382         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:49' v\_norm = v\_norm\_cur;}}
\DoxyCodeLine{00383         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_norm = v\_norm\_cur;}
\DoxyCodeLine{00384         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:51' while 1}}
\DoxyCodeLine{00385         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:47' H\_P = H\_C;}}
\DoxyCodeLine{00386         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:48' x\_tmp = x\_cur;}}
\DoxyCodeLine{00387         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:49' v\_norm = v\_norm\_cur;}}
\DoxyCodeLine{00388         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:50' per = false;}}
\DoxyCodeLine{00389         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:51' while 1}}
\DoxyCodeLine{00390         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} iter = 0;}
\DoxyCodeLine{00391         time = omp\_get\_wtime();}
\DoxyCodeLine{00392         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} itr = 0; itr < \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}}; itr++) \{}
\DoxyCodeLine{00393             iter = \mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}} ? rand() \% \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} : itr;}
\DoxyCodeLine{00394 \textcolor{comment}{//            cout << iter << " ";}}
\DoxyCodeLine{00395             \textcolor{comment}{// H\_Apply permutation strategy to update x\_cur and v\_norm\_cur}}
\DoxyCodeLine{00396             \textcolor{comment}{// [x\_tmp, v\_norm\_temp] = block\_opt(H\_P, y\_a, x\_tmp, n, indicator);}}
\DoxyCodeLine{00397             \textcolor{comment}{// Corresponds to H\_Algorithm 12 (Block Optimal) in Report 10}}
\DoxyCodeLine{00398             \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; k1++) \{}
\DoxyCodeLine{00399                 \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{00400                     H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * k1] = H[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[iter][k1] -\/ 1)];}
\DoxyCodeLine{00401                 \}}
\DoxyCodeLine{00402                 x\_tmp[k1] = x\_per[\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[iter][k1] -\/ 1];}
\DoxyCodeLine{00403             \}}
\DoxyCodeLine{00404             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:104' per = true;}}
\DoxyCodeLine{00405             per = iter;}
\DoxyCodeLine{00406 }
\DoxyCodeLine{00407             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:56' for j = 1:q}}
\DoxyCodeLine{00408             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} j = 0; j < \mbox{\hyperlink{namespacecils_1_1program__def_a39e55918a5f7058c3f62ef2e96f26af3}{q}}; j++) \{}
\DoxyCodeLine{00409                 \textcolor{comment}{// cur\_1st refers to the column of H\_C where the current block starts}}
\DoxyCodeLine{00410                 \textcolor{comment}{// cur\_end refers to the column of H\_C where the current block ends}}
\DoxyCodeLine{00411                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:60' cur\_1st = indicator(1, j);}}
\DoxyCodeLine{00412                 cur\_1st = \mbox{\hyperlink{namespacecils_1_1program__def_ad90e6aae649723e9be8ab64efc945a42}{indicator}}[2 * j];}
\DoxyCodeLine{00413                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:61' cur\_end = indicator(2, j);}}
\DoxyCodeLine{00414                 cur\_end = \mbox{\hyperlink{namespacecils_1_1program__def_ad90e6aae649723e9be8ab64efc945a42}{indicator}}[2 * j + 1];}
\DoxyCodeLine{00415 }
\DoxyCodeLine{00416                 y\_bar.assign(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{00417                 \textcolor{keywordflow}{for} (k1 = 0; k1 <= cur\_1st -\/ 2; k1++) \{}
\DoxyCodeLine{00418                     \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{00419                         t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{00420                         y\_bar[i] += H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * x\_tmp[k1];}
\DoxyCodeLine{00421                     \}}
\DoxyCodeLine{00422                 \}}
\DoxyCodeLine{00423                 \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} -\/ cur\_end; k1++) \{}
\DoxyCodeLine{00424                     \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{00425                         t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{00426                         y\_bar[i] += H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_end + t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * x\_tmp[cur\_end + k1];}
\DoxyCodeLine{00427                     \}}
\DoxyCodeLine{00428                 \}}
\DoxyCodeLine{00429                 \textcolor{keywordflow}{for} (t = 0; t < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; t++) \{}
\DoxyCodeLine{00430                     y\_bar[t] = y\_a[t] -\/ y\_bar[t];}
\DoxyCodeLine{00431                 \}}
\DoxyCodeLine{00432 }
\DoxyCodeLine{00433                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{00434                     \textcolor{keywordflow}{for} (k1 = 0; k1 <= cur\_1st -\/ 2; k1++) \{}
\DoxyCodeLine{00435                         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{00436                             t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{00437                             printf(\textcolor{stringliteral}{"\%8.5f "}, H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})]);}
\DoxyCodeLine{00438                         \}}
\DoxyCodeLine{00439                         cout << endl;}
\DoxyCodeLine{00440                     \}}
\DoxyCodeLine{00441                     helper::display\_vector<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, y\_bar.data(), \textcolor{stringliteral}{"y\_bar"});}
\DoxyCodeLine{00442                 \}}
\DoxyCodeLine{00443 }
\DoxyCodeLine{00444                 \textcolor{comment}{//  Compute optimal solution}}
\DoxyCodeLine{00445                 t = cur\_end -\/ cur\_1st + 1;}
\DoxyCodeLine{00446                 H\_A.resize(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * t);}
\DoxyCodeLine{00447                 \textcolor{keywordflow}{for} (k1 = 0; k1 < t; k1++) \{}
\DoxyCodeLine{00448                     \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{00449                         H\_A[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * k1] = H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_1st -\/ 1 + k1)];}
\DoxyCodeLine{00450                     \}}
\DoxyCodeLine{00451                 \}}
\DoxyCodeLine{00452                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:80' z = obils(H\_adj, y\_bar, l, u);}}
\DoxyCodeLine{00453                 z.assign(t, 0);}
\DoxyCodeLine{00454                 z\_z.assign(t, 0);}
\DoxyCodeLine{00455 }
\DoxyCodeLine{00456                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{00457                     \textcolor{comment}{//z.assign(t, 0);}}
\DoxyCodeLine{00458                     \textcolor{comment}{//z\_z.assign(t, 0);}}
\DoxyCodeLine{00459                     \mbox{\hyperlink{classcils_1_1cils__reduction}{cils\_reduction<scalar, index>}} reduction2(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, t, 0, upper, 0, 0);}
\DoxyCodeLine{00460                     \mbox{\hyperlink{classcils_1_1cils__search}{cils\_search<scalar, index>}} ils2(t, t, this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}});}
\DoxyCodeLine{00461                     reduction2.\mbox{\hyperlink{classcils_1_1cils__reduction_aecca29f37a92ec0778a36ac17ab177c3}{cils\_obils\_reduction\_matlab}}(H\_A, y\_bar);}
\DoxyCodeLine{00462                     helper::display\_matrix<scalar, index>(t, t, reduction2.\mbox{\hyperlink{classcils_1_1cils__reduction_a14fa9ac8812783f80b56bf82a2170a70}{R\_Q}}.data(), \textcolor{stringliteral}{"MR\_Q"});}
\DoxyCodeLine{00463                     reduction2.\mbox{\hyperlink{classcils_1_1cils__reduction_a1ac2c043a200afaf380f9c59c019b980}{cils\_obils\_matlab}}(H\_A, y\_bar);}
\DoxyCodeLine{00464                     helper::display\_matrix<scalar, index>(1, t, reduction2.\mbox{\hyperlink{classcils_1_1cils__reduction_a866b4360c4e6f432154341330c6a77bb}{y\_q}}.data(), \textcolor{stringliteral}{"Mz\_z"});}
\DoxyCodeLine{00465                 \}}
\DoxyCodeLine{00466 }
\DoxyCodeLine{00467                 z.assign(t, 0);}
\DoxyCodeLine{00468                 z\_z.assign(t, 0);}
\DoxyCodeLine{00469                 \mbox{\hyperlink{classcils_1_1cils__reduction}{cils\_reduction<scalar, index>}} reduction(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, t, 0, upper, 0, 0);}
\DoxyCodeLine{00470                 reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_ae931950b0b3189911c26c286d27b4243}{cils\_obils\_reduction}}(H\_A, y\_bar);}
\DoxyCodeLine{00471 }
\DoxyCodeLine{00472                 \mbox{\hyperlink{classcils_1_1cils__search}{cils\_search<scalar, index>}} ils(t, t, this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}});}
\DoxyCodeLine{00473                 ils.\mbox{\hyperlink{classcils_1_1cils__search_a5ce0e601706b8cfb6454e27a659418f0}{obils\_search2}}(reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a14fa9ac8812783f80b56bf82a2170a70}{R\_Q}}, reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a866b4360c4e6f432154341330c6a77bb}{y\_q}}, z\_z);}
\DoxyCodeLine{00474 }
\DoxyCodeLine{00475                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:81' x\_tmp(cur\_1st:cur\_end) = 2 * z + e\_vec;}}
\DoxyCodeLine{00476                 \textcolor{keywordflow}{for} (i = 0; i < t; i++) \{}
\DoxyCodeLine{00477                     z[reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a579742eeb2f359ffcb7cb86725a7b65a}{p}}[i] -\/ 1] = z\_z[i];}
\DoxyCodeLine{00478                 \}}
\DoxyCodeLine{00479                 \textcolor{keywordflow}{for} (i = 0; i < t; i++) \{}
\DoxyCodeLine{00480                     x\_tmp[cur\_1st + i -\/ 1] = z[i];}
\DoxyCodeLine{00481                 \}}
\DoxyCodeLine{00482                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{00483                     helper::display\_matrix<scalar, index>(t, t, reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a14fa9ac8812783f80b56bf82a2170a70}{R\_Q}}.data(), \textcolor{stringliteral}{"R\_Q"});}
\DoxyCodeLine{00484                     helper::display\_matrix<scalar, index>(1, t, z.data(), \textcolor{stringliteral}{"z"});}
\DoxyCodeLine{00485                 \}}
\DoxyCodeLine{00486             \}}
\DoxyCodeLine{00487 }
\DoxyCodeLine{00488             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{00489                 helper::display\_vector<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, x\_tmp.data(), \textcolor{stringliteral}{"x\_tmp\_"} + std::to\_string(iter));}
\DoxyCodeLine{00490             \}}
\DoxyCodeLine{00491             \textcolor{comment}{// x\_tmp}}
\DoxyCodeLine{00492             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:84' v\_norm\_temp = norm(y\_a -\/ H\_P * x\_tmp);}}
\DoxyCodeLine{00493             v\_norm\_cur = \mbox{\hyperlink{namespacehelper_ad26b5d4b9e5c4d32f7de4fe3af8a7327}{helper::find\_residual}}(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, H\_P.data(), x\_tmp.data(), y\_a.data());}
\DoxyCodeLine{00494             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:86' if v\_norm\_temp < v\_norm}}
\DoxyCodeLine{00495 \textcolor{comment}{//            printf("v\_t:\%8.5f, v\_n:\%8.5f\(\backslash\)n", v\_norm\_temp, v\_norm);}}
\DoxyCodeLine{00496             \textcolor{keywordflow}{if} (v\_norm\_cur < v\_norm) \{}
\DoxyCodeLine{00497                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:87' x\_cur = x\_tmp;}}
\DoxyCodeLine{00498                 \textcolor{keywordflow}{for} (t = 0; t < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; t++) \{}
\DoxyCodeLine{00499                     x\_per[t] = x\_tmp[t];}
\DoxyCodeLine{00500                 \}}
\DoxyCodeLine{00501                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:88' v\_norm\_cur = v\_norm\_temp;}}
\DoxyCodeLine{00502                 \textcolor{comment}{//  v\_norm\_cur = v\_norm\_temp;}}
\DoxyCodeLine{00503                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:89' if per}}
\DoxyCodeLine{00504                 best\_per = per;}
\DoxyCodeLine{00505                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:94' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{00506                 \textcolor{keywordflow}{if} (v\_norm\_cur <= tolerance) \{}
\DoxyCodeLine{00507                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:95' stopping(2)=1;}}
\DoxyCodeLine{00508                     stopping[1] = 1;}
\DoxyCodeLine{00509                     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}} == 3)}
\DoxyCodeLine{00510                         iter = \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}};}
\DoxyCodeLine{00511                 \}}
\DoxyCodeLine{00512                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:99' v\_norm = v\_norm\_cur;}}
\DoxyCodeLine{00513                 v\_norm = v\_norm\_cur;}
\DoxyCodeLine{00514             \}}
\DoxyCodeLine{00515             \textcolor{comment}{// If we don't decrease the residual, keep trying permutations}}
\DoxyCodeLine{00516         \}}
\DoxyCodeLine{00517         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:44' P\_tmp = eye(n);}}
\DoxyCodeLine{00518         vector<scalar> P\_cur(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), P\_tmp(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);\textcolor{comment}{//, I(n * n, 0);}}
\DoxyCodeLine{00519         helper::eye<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_tmp.data());}
\DoxyCodeLine{00520         helper::eye<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_cur.data());}
\DoxyCodeLine{00521 }
\DoxyCodeLine{00522         \textcolor{keywordflow}{if} (best\_per >= 0) \{}
\DoxyCodeLine{00523             \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; k1++) \{}
\DoxyCodeLine{00524                 \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{00525                     P\_cur[i + \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * k1] = P\_tmp[i + \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * (\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[best\_per][k1] -\/ 1)];}
\DoxyCodeLine{00526                 \}}
\DoxyCodeLine{00527             \}}
\DoxyCodeLine{00528         \}}
\DoxyCodeLine{00529         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:115' x\_cur = P\_cur * x\_cur;}}
\DoxyCodeLine{00530         helper::mtimes\_Axy<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_cur.data(), x\_per.data(), x\_tmp.data());}
\DoxyCodeLine{00531         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{00532             x\_cur[i] = x\_tmp[i];}
\DoxyCodeLine{00533         \}}
\DoxyCodeLine{00534 \textcolor{comment}{//        helper::display\_vector<scalar, index>(n, x\_tmp.data(), "x\_tmp");}}
\DoxyCodeLine{00535         time = omp\_get\_wtime() -\/ time;}
\DoxyCodeLine{00536         \textcolor{keywordflow}{return} \{stopping, time, v\_norm\_cur\};}
\DoxyCodeLine{00537     \}}
\DoxyCodeLine{00538 }
\DoxyCodeLine{00539     \textcolor{keyword}{template}<\textcolor{keyword}{typename} scalar, \textcolor{keyword}{typename} index, index m, index n>}
\DoxyCodeLine{00540     \mbox{\hyperlink{structcils_1_1return_type}{returnType<scalar, index>}}}
\DoxyCodeLine{\Hypertarget{cils__block__search_8cpp_source_l00541}\mbox{\hyperlink{classcils_1_1cils_ade3c2c0ebcefcfd91d92bb1dec6e1aa9}{00541}}     \mbox{\hyperlink{classcils_1_1cils}{cils<scalar, index, m, n>::cils\_scp\_block\_suboptimal\_serial}}(vector<scalar> \&x\_cur, \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_norm\_cur, \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} \mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}}) \{}
\DoxyCodeLine{00542         vector<scalar> H\_A, x\_tmp(x\_cur), x\_per(x\_cur), y\_bar(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0), y(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{00543         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:24' stopping=zeros(1,3);}}
\DoxyCodeLine{00544         vector<scalar> stopping(3, 0);}
\DoxyCodeLine{00545         array<scalar, m * n> H\_P(H);}
\DoxyCodeLine{00546         vector<scalar> z(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), z\_z(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{00547         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{00548             helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, H\_P.data(), \textcolor{stringliteral}{"H"});}
\DoxyCodeLine{00549             helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 1, x\_tmp.data(), \textcolor{stringliteral}{"x\_tmp"});}
\DoxyCodeLine{00550         \}}
\DoxyCodeLine{00551         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} time = omp\_get\_wtime();}
\DoxyCodeLine{00552         \textcolor{comment}{//  Subfunctions: SCP\_opt}}
\DoxyCodeLine{00553 }
\DoxyCodeLine{00554         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:25' b\_count = 0;}}
\DoxyCodeLine{00555         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} b\_count = 0;}
\DoxyCodeLine{00556         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:27' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{00557         \textcolor{keywordflow}{if} (v\_norm\_cur <= tolerance) \{}
\DoxyCodeLine{00558             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:28' stopping(1)=1;}}
\DoxyCodeLine{00559             stopping[0] = 1;}
\DoxyCodeLine{00560             time = omp\_get\_wtime() -\/ time;}
\DoxyCodeLine{00561             \textcolor{keywordflow}{return} \{stopping, time, v\_norm\_cur\};}
\DoxyCodeLine{00562         \}}
\DoxyCodeLine{00563         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} cur\_1st, cur\_end, i, t, k1, per = -\/1, best\_per = -\/1;}
\DoxyCodeLine{00564         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_norm = v\_norm\_cur;}
\DoxyCodeLine{00565         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} iter = 0;}
\DoxyCodeLine{00566 }
\DoxyCodeLine{00567         time = omp\_get\_wtime();}
\DoxyCodeLine{00568         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} itr = 0; itr < \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}}; itr++) \{}
\DoxyCodeLine{00569             iter = \mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}} ? rand() \% \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} : itr;}
\DoxyCodeLine{00570             \textcolor{comment}{//            cout << iter << " ";}}
\DoxyCodeLine{00571             \textcolor{comment}{// H\_Apply permutation strategy to update x\_cur and v\_norm\_cur}}
\DoxyCodeLine{00572             \textcolor{comment}{// [x\_tmp, v\_norm\_temp] = block\_opt(H\_P, y\_a, x\_tmp, n, indicator);}}
\DoxyCodeLine{00573             \textcolor{comment}{// Corresponds to H\_Algorithm 12 (Block Optimal) in Report 10}}
\DoxyCodeLine{00574             \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; k1++) \{}
\DoxyCodeLine{00575                 \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{00576                     H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * k1] = H[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[iter][k1] -\/ 1)];}
\DoxyCodeLine{00577                 \}}
\DoxyCodeLine{00578                 x\_tmp[k1] = x\_per[\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[iter][k1] -\/ 1];}
\DoxyCodeLine{00579             \}}
\DoxyCodeLine{00580             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:104' per = true;}}
\DoxyCodeLine{00581             per = iter;}
\DoxyCodeLine{00582 }
\DoxyCodeLine{00583             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:56' for j = 1:q}}
\DoxyCodeLine{00584             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} j = 0; j < \mbox{\hyperlink{namespacecils_1_1program__def_a39e55918a5f7058c3f62ef2e96f26af3}{q}}; j++) \{}
\DoxyCodeLine{00585                 \textcolor{comment}{// cur\_1st refers to the column of H\_C where the current block starts}}
\DoxyCodeLine{00586                 \textcolor{comment}{// cur\_end refers to the column of H\_C where the current block ends}}
\DoxyCodeLine{00587                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:60' cur\_1st = indicator(1, j);}}
\DoxyCodeLine{00588                 cur\_1st = \mbox{\hyperlink{namespacecils_1_1program__def_ad90e6aae649723e9be8ab64efc945a42}{indicator}}[2 * j];}
\DoxyCodeLine{00589                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:61' cur\_end = indicator(2, j);}}
\DoxyCodeLine{00590                 cur\_end = \mbox{\hyperlink{namespacecils_1_1program__def_ad90e6aae649723e9be8ab64efc945a42}{indicator}}[2 * j + 1];}
\DoxyCodeLine{00591 }
\DoxyCodeLine{00592                 y\_bar.assign(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{00593                 \textcolor{keywordflow}{for} (k1 = 0; k1 <= cur\_1st -\/ 2; k1++) \{}
\DoxyCodeLine{00594                     \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{00595                         t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{00596                         y\_bar[i] += H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * x\_tmp[k1];}
\DoxyCodeLine{00597                     \}}
\DoxyCodeLine{00598                 \}}
\DoxyCodeLine{00599                 \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} -\/ cur\_end; k1++) \{}
\DoxyCodeLine{00600                     \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{00601                         t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{00602                         y\_bar[i] += H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_end + t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * x\_tmp[cur\_end + k1];}
\DoxyCodeLine{00603                     \}}
\DoxyCodeLine{00604                 \}}
\DoxyCodeLine{00605                 \textcolor{keywordflow}{for} (t = 0; t < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; t++) \{}
\DoxyCodeLine{00606                     y\_bar[t] = y\_a[t] -\/ y\_bar[t];}
\DoxyCodeLine{00607                 \}}
\DoxyCodeLine{00608 }
\DoxyCodeLine{00609                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{00610                     \textcolor{keywordflow}{for} (k1 = 0; k1 <= cur\_1st -\/ 2; k1++) \{}
\DoxyCodeLine{00611                         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{00612                             t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{00613                             printf(\textcolor{stringliteral}{"\%8.5f "}, H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})]);}
\DoxyCodeLine{00614                         \}}
\DoxyCodeLine{00615                         cout << endl;}
\DoxyCodeLine{00616                     \}}
\DoxyCodeLine{00617                     helper::display\_vector<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, y\_bar.data(), \textcolor{stringliteral}{"y\_bar"});}
\DoxyCodeLine{00618                 \}}
\DoxyCodeLine{00619 }
\DoxyCodeLine{00620                 t = cur\_end -\/ cur\_1st + 1;}
\DoxyCodeLine{00621                 H\_A.resize(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * t);}
\DoxyCodeLine{00622                 \textcolor{keywordflow}{for} (k1 = 0; k1 < t; k1++) \{}
\DoxyCodeLine{00623                     \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{00624                         H\_A[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * k1] = H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_1st -\/ 1 + k1)]; \textcolor{comment}{//2.0 *}}
\DoxyCodeLine{00625                     \}}
\DoxyCodeLine{00626                 \}}
\DoxyCodeLine{00627                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:80' z = obils(H\_adj, y\_bar, l, u);}}
\DoxyCodeLine{00628 }
\DoxyCodeLine{00629                 z.assign(t, 0);}
\DoxyCodeLine{00630                 z\_z.assign(t, 0);}
\DoxyCodeLine{00631                 \mbox{\hyperlink{classcils_1_1cils__reduction}{cils\_reduction<scalar, index>}} reduction(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, t, 0, upper, 0, 0);}
\DoxyCodeLine{00632                 reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_ae931950b0b3189911c26c286d27b4243}{cils\_obils\_reduction}}(H\_A, y\_bar);}
\DoxyCodeLine{00633 }
\DoxyCodeLine{00634 }
\DoxyCodeLine{00635                 \mbox{\hyperlink{classcils_1_1cils__search}{cils\_search<scalar, index>}} ils(t, t, this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}});}
\DoxyCodeLine{00636                 \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} ds = t / \mbox{\hyperlink{namespacecils_1_1program__def_a3a17b570cfa1a83160e8e2edb02c1e68}{block\_size}};}
\DoxyCodeLine{00637                 \textcolor{keywordflow}{if} (t \% \mbox{\hyperlink{namespacecils_1_1program__def_a3a17b570cfa1a83160e8e2edb02c1e68}{block\_size}} != 0) \{}
\DoxyCodeLine{00638                     ds = 1;}
\DoxyCodeLine{00639                     \mbox{\hyperlink{namespacecils_1_1program__def_a3a17b570cfa1a83160e8e2edb02c1e68}{block\_size}} = t;}
\DoxyCodeLine{00640                 \}}
\DoxyCodeLine{00641                 vector<index> d(ds, \mbox{\hyperlink{namespacecils_1_1program__def_a3a17b570cfa1a83160e8e2edb02c1e68}{block\_size}});}
\DoxyCodeLine{00642                 vector<scalar> y\_b(reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a866b4360c4e6f432154341330c6a77bb}{y\_q}});}
\DoxyCodeLine{00643                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} s = d.size() -\/ 2; s >= 0; s-\/-\/) \{}
\DoxyCodeLine{00644                     d[s] += d[s + 1];}
\DoxyCodeLine{00645                 \}}
\DoxyCodeLine{00646 }
\DoxyCodeLine{00647                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} s = 0; s < ds; s++) \{}
\DoxyCodeLine{00648                     \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} n\_dx\_q\_1 = d[s];}
\DoxyCodeLine{00649                     \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} n\_dx\_q\_0 = s == ds -\/ 1 ? 0 : d[s + 1];}
\DoxyCodeLine{00650 }
\DoxyCodeLine{00651                     \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} row = n\_dx\_q\_0; row < n\_dx\_q\_1; row++) \{}
\DoxyCodeLine{00652                         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} sum = 0;}
\DoxyCodeLine{00653                         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} col = n\_dx\_q\_1; col < t; col++) \{}
\DoxyCodeLine{00654                             sum += reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a14fa9ac8812783f80b56bf82a2170a70}{R\_Q}}[col * t + row] * z\_z[col];}
\DoxyCodeLine{00655                         \}}
\DoxyCodeLine{00656                         y\_b[row] = reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a866b4360c4e6f432154341330c6a77bb}{y\_q}}[row] -\/ sum;}
\DoxyCodeLine{00657                     \}}
\DoxyCodeLine{00658 }
\DoxyCodeLine{00659                     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}})}
\DoxyCodeLine{00660                         printf(\textcolor{stringliteral}{"n\_dx\_q\_0:\%d, n\_dx\_q\_1:\%d\(\backslash\)n"}, n\_dx\_q\_0, n\_dx\_q\_1);}
\DoxyCodeLine{00661 }
\DoxyCodeLine{00662                     ils.\mbox{\hyperlink{classcils_1_1cils__search_afbc108cdc3d8e1d47d3b2bb4513ce520}{obils\_search}}(n\_dx\_q\_0, n\_dx\_q\_1, 1, reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a14fa9ac8812783f80b56bf82a2170a70}{R\_Q}}.data(), y\_b.data(), z\_z);}
\DoxyCodeLine{00663                 \}}
\DoxyCodeLine{00664                 \textcolor{comment}{// helper::display\_vector(n, z\_z.data(), "z\_z");}}
\DoxyCodeLine{00665                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:81' x\_tmp(cur\_1st:cur\_end) = 2 * z + e\_vec;}}
\DoxyCodeLine{00666                 \textcolor{keywordflow}{for} (i = 0; i < t; i++) \{}
\DoxyCodeLine{00667                     z[reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a579742eeb2f359ffcb7cb86725a7b65a}{p}}[i] -\/ 1] = z\_z[i];}
\DoxyCodeLine{00668                 \}}
\DoxyCodeLine{00669                 \textcolor{keywordflow}{for} (i = 0; i < t; i++) \{}
\DoxyCodeLine{00670                     x\_tmp[cur\_1st + i -\/ 1] = z[i];}
\DoxyCodeLine{00671                 \}}
\DoxyCodeLine{00672                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{00673                     helper::display\_matrix<scalar, index>(t, t, reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a14fa9ac8812783f80b56bf82a2170a70}{R\_Q}}.data(), \textcolor{stringliteral}{"R\_Q"});}
\DoxyCodeLine{00674                     helper::display\_matrix<scalar, index>(1, t, z.data(), \textcolor{stringliteral}{"z"});}
\DoxyCodeLine{00675                 \}}
\DoxyCodeLine{00676             \}}
\DoxyCodeLine{00677 }
\DoxyCodeLine{00678             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{00679                 helper::display\_vector<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, x\_tmp.data(), \textcolor{stringliteral}{"x\_tmp\_"} + std::to\_string(iter));}
\DoxyCodeLine{00680             \}}
\DoxyCodeLine{00681             \textcolor{comment}{// x\_tmp}}
\DoxyCodeLine{00682             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:84' v\_norm\_temp = norm(y\_a -\/ H\_P * x\_tmp);}}
\DoxyCodeLine{00683             v\_norm\_cur = \mbox{\hyperlink{namespacehelper_ad26b5d4b9e5c4d32f7de4fe3af8a7327}{helper::find\_residual}}(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, H\_P.data(), x\_tmp.data(), y\_a.data());}
\DoxyCodeLine{00684             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:86' if v\_norm\_temp < v\_norm}}
\DoxyCodeLine{00685             \textcolor{comment}{//            printf("v\_t:\%8.5f, v\_n:\%8.5f\(\backslash\)n", v\_norm\_temp, v\_norm);}}
\DoxyCodeLine{00686             \textcolor{keywordflow}{if} (v\_norm\_cur < v\_norm) \{}
\DoxyCodeLine{00687                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:87' x\_cur = x\_tmp;}}
\DoxyCodeLine{00688                 \textcolor{keywordflow}{for} (t = 0; t < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; t++) \{}
\DoxyCodeLine{00689                     x\_per[t] = x\_tmp[t];}
\DoxyCodeLine{00690                 \}}
\DoxyCodeLine{00691                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:88' v\_norm\_cur = v\_norm\_temp;}}
\DoxyCodeLine{00692                 \textcolor{comment}{//  v\_norm\_cur = v\_norm\_temp;}}
\DoxyCodeLine{00693                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:89' if per}}
\DoxyCodeLine{00694                 best\_per = per;}
\DoxyCodeLine{00695                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:94' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{00696                 \textcolor{keywordflow}{if} (v\_norm\_cur <= tolerance) \{}
\DoxyCodeLine{00697                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:95' stopping(2)=1;}}
\DoxyCodeLine{00698                     stopping[1] = 1;}
\DoxyCodeLine{00699                     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}} == 3)}
\DoxyCodeLine{00700                         iter = \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}};}
\DoxyCodeLine{00701                 \}}
\DoxyCodeLine{00702                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:99' v\_norm = v\_norm\_cur;}}
\DoxyCodeLine{00703                 v\_norm = v\_norm\_cur;}
\DoxyCodeLine{00704             \}}
\DoxyCodeLine{00705             \textcolor{comment}{// If we don't decrease the residual, keep trying permutations}}
\DoxyCodeLine{00706         \}}
\DoxyCodeLine{00707         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:44' P\_tmp = eye(n);}}
\DoxyCodeLine{00708         vector<scalar> P\_cur(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), P\_tmp(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);\textcolor{comment}{//, I(n * n, 0);}}
\DoxyCodeLine{00709         helper::eye<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_tmp.data());}
\DoxyCodeLine{00710         helper::eye<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_cur.data());}
\DoxyCodeLine{00711 }
\DoxyCodeLine{00712         \textcolor{keywordflow}{if} (best\_per >= 0) \{}
\DoxyCodeLine{00713             \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; k1++) \{}
\DoxyCodeLine{00714                 \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{00715                     P\_cur[i + \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * k1] = P\_tmp[i + \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * (\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[best\_per][k1] -\/ 1)];}
\DoxyCodeLine{00716                 \}}
\DoxyCodeLine{00717             \}}
\DoxyCodeLine{00718         \}}
\DoxyCodeLine{00719         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:115' x\_cur = P\_cur * x\_cur;}}
\DoxyCodeLine{00720         helper::mtimes\_Axy<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_cur.data(), x\_per.data(), x\_tmp.data());}
\DoxyCodeLine{00721         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{00722             x\_cur[i] = x\_tmp[i];}
\DoxyCodeLine{00723         \}}
\DoxyCodeLine{00724         \textcolor{comment}{//        helper::display\_vector<scalar, index>(n, x\_tmp.data(), "x\_tmp");}}
\DoxyCodeLine{00725         time = omp\_get\_wtime() -\/ time;}
\DoxyCodeLine{00726         \textcolor{keywordflow}{return} \{stopping, time, v\_norm\_cur\};}
\DoxyCodeLine{00727     \}}
\DoxyCodeLine{00728 }
\DoxyCodeLine{00729     \textcolor{keyword}{template}<\textcolor{keyword}{typename} scalar, \textcolor{keyword}{typename} index, index m, index n>}
\DoxyCodeLine{00730     \mbox{\hyperlink{structcils_1_1return_type}{returnType<scalar, index>}}}
\DoxyCodeLine{\Hypertarget{cils__block__search_8cpp_source_l00731}\mbox{\hyperlink{classcils_1_1cils_a5978b0af1d63b415748590b8b518ce13}{00731}}     \mbox{\hyperlink{classcils_1_1cils}{cils<scalar, index, m, n>::cils\_scp\_block\_babai\_serial}}(vector<scalar> \&x\_cur, \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_norm\_cur, \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} \mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}}) \{}
\DoxyCodeLine{00732         vector<scalar> R\_t(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), Q\_t(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), Piv\_cum(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), best\_piv(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{00733         \mbox{\hyperlink{namespacehelper_a05330a2b0997edb2c1d8304fb4ae78fd}{helper::eye}}(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, best\_piv.data());}
\DoxyCodeLine{00734 \textcolor{comment}{//        verbose = true;}}
\DoxyCodeLine{00735 }
\DoxyCodeLine{00736         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:24' stopping=zeros(1,3);}}
\DoxyCodeLine{00737         vector<scalar> y\_bar(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0), y(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{00738         vector<scalar> stopping(3, 0);}
\DoxyCodeLine{00739         vector<scalar> H\_P(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);\textcolor{comment}{//, H\_H(H);}}
\DoxyCodeLine{00740         vector<scalar> z, z\_z, x\_tmp(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), x\_per(x\_cur); \textcolor{comment}{//z\_z = Z * z;}}
\DoxyCodeLine{00741 }
\DoxyCodeLine{00742         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{00743             helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, H.data(), \textcolor{stringliteral}{"H"});}
\DoxyCodeLine{00744             helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 1, x\_tmp.data(), \textcolor{stringliteral}{"x\_tmp"});}
\DoxyCodeLine{00745         \}}
\DoxyCodeLine{00746 }
\DoxyCodeLine{00747         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} time = omp\_get\_wtime();}
\DoxyCodeLine{00748         \textcolor{comment}{//  Subfunctions: SCP\_opt}}
\DoxyCodeLine{00749 }
\DoxyCodeLine{00750         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:25' b\_count = 0;}}
\DoxyCodeLine{00751         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} b\_count = 0;}
\DoxyCodeLine{00752         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:27' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{00753         \textcolor{keywordflow}{if} (v\_norm\_cur <= tolerance) \{}
\DoxyCodeLine{00754             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:28' stopping(1)=1;}}
\DoxyCodeLine{00755             stopping[0] = 1;}
\DoxyCodeLine{00756             time = omp\_get\_wtime() -\/ time;}
\DoxyCodeLine{00757             \textcolor{keywordflow}{return} \{stopping, time, v\_norm\_cur\};}
\DoxyCodeLine{00758         \}}
\DoxyCodeLine{00759 }
\DoxyCodeLine{00760         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} cur\_1st, cur\_end, t, i, j, k1, per = -\/1, best\_per = -\/1;}
\DoxyCodeLine{00761         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_norm = v\_norm\_cur;}
\DoxyCodeLine{00762         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} iter = 0;}
\DoxyCodeLine{00763         time = omp\_get\_wtime();}
\DoxyCodeLine{00764 }
\DoxyCodeLine{00765         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} itr = 0; itr < \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}}; itr++) \{}
\DoxyCodeLine{00766             iter = \mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}} ? rand() \% \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} : itr;}
\DoxyCodeLine{00767             H\_P.assign(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{00768             \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; k1++) \{}
\DoxyCodeLine{00769                 \textcolor{keywordflow}{for} (j = 0; j < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; j++) \{}
\DoxyCodeLine{00770                     H\_P[j + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * k1] = H[j + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[iter][k1] -\/ 1)];}
\DoxyCodeLine{00771                 \}}
\DoxyCodeLine{00772                 x\_tmp[k1] = x\_per[\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[iter][k1] -\/ 1];}
\DoxyCodeLine{00773             \}}
\DoxyCodeLine{00774             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{00775                 helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, H\_P.data(), \textcolor{stringliteral}{"H\_P"});}
\DoxyCodeLine{00776                 helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 1, x\_tmp.data(), \textcolor{stringliteral}{"x\_tmp"});}
\DoxyCodeLine{00777             \}}
\DoxyCodeLine{00778 }
\DoxyCodeLine{00779             R\_t.assign(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{00780             Q\_t.assign(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{00781             Piv\_cum.assign(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{00782             cils\_partition\_deficient(x\_tmp.data(), Q\_t.data(), R\_t.data(), H\_P.data(), Piv\_cum.data());}
\DoxyCodeLine{00783 }
\DoxyCodeLine{00784             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{00785                 helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, H\_P.data(), \textcolor{stringliteral}{"H\_P"});}
\DoxyCodeLine{00786                 helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, Q\_t.data(), \textcolor{stringliteral}{"Q\_t"});}
\DoxyCodeLine{00787                 helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, R\_t.data(), \textcolor{stringliteral}{"R\_t"});}
\DoxyCodeLine{00788                 helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, Piv\_cum.data(), \textcolor{stringliteral}{"Piv\_cum"});}
\DoxyCodeLine{00789                 helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 1, x\_tmp.data(), \textcolor{stringliteral}{"x\_tmp"});}
\DoxyCodeLine{00790             \}}
\DoxyCodeLine{00791             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:104' per = true;}}
\DoxyCodeLine{00792             per = iter;}
\DoxyCodeLine{00793 }
\DoxyCodeLine{00794             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:56' for j = 1:q}}
\DoxyCodeLine{00795             \textcolor{keywordflow}{for} (j = 0; j < \mbox{\hyperlink{namespacecils_1_1program__def_a39e55918a5f7058c3f62ef2e96f26af3}{q}}; j++) \{}
\DoxyCodeLine{00796 }
\DoxyCodeLine{00797                 \textcolor{comment}{// Get the QR factorization corresponding to block j}}
\DoxyCodeLine{00798                 cur\_1st = \mbox{\hyperlink{namespacecils_1_1program__def_ad90e6aae649723e9be8ab64efc945a42}{indicator}}[2 * j];}
\DoxyCodeLine{00799                 cur\_end = \mbox{\hyperlink{namespacecils_1_1program__def_ad90e6aae649723e9be8ab64efc945a42}{indicator}}[2 * j + 1];}
\DoxyCodeLine{00800 }
\DoxyCodeLine{00801                 \textcolor{comment}{//  Compute y\_bar}}
\DoxyCodeLine{00802                 y\_bar.assign(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{00803                 \textcolor{keywordflow}{for} (k1 = 0; k1 <= cur\_1st -\/ 2; k1++) \{}
\DoxyCodeLine{00804                     \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{00805                         t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{00806                         y\_bar[i] += H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * x\_tmp[k1];}
\DoxyCodeLine{00807                     \}}
\DoxyCodeLine{00808                 \}}
\DoxyCodeLine{00809                 \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} -\/ cur\_end; k1++) \{}
\DoxyCodeLine{00810                     \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{00811                         t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{00812                         y\_bar[i] += H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_end + t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * x\_tmp[cur\_end + k1];}
\DoxyCodeLine{00813                     \}}
\DoxyCodeLine{00814                 \}}
\DoxyCodeLine{00815                 \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; k1++) \{}
\DoxyCodeLine{00816                     y\_bar[k1] = y\_a[k1] -\/ y\_bar[k1];}
\DoxyCodeLine{00817                 \}}
\DoxyCodeLine{00818 }
\DoxyCodeLine{00819                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}})}
\DoxyCodeLine{00820                     \mbox{\hyperlink{namespacehelper_aca849a924fa3ac396513505fe1cdfa2b}{helper::display\_vector}}(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, y\_bar.data(), \textcolor{stringliteral}{"y\_bar"});}
\DoxyCodeLine{00821 }
\DoxyCodeLine{00822                 \textcolor{comment}{// 'Babai\_Gen:46' y\_bar = Q' * y\_bar;}}
\DoxyCodeLine{00823                 \textcolor{comment}{// Caution: Only use 1,t entry of the vector y.}}
\DoxyCodeLine{00824                 t = cur\_1st > cur\_end ? 0 : cur\_end -\/ cur\_1st + 1;}
\DoxyCodeLine{00825                 y.assign(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{00826                 \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; k1++) \{}
\DoxyCodeLine{00827                     \textcolor{keywordflow}{for} (i = 0; i < t; i++) \{}
\DoxyCodeLine{00828                         y[i] += Q\_t[k1 + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_1st -\/ 1 + i + k1 / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * y\_bar[k1];}
\DoxyCodeLine{00829                     \}}
\DoxyCodeLine{00830                 \}}
\DoxyCodeLine{00831 }
\DoxyCodeLine{00832                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}})}
\DoxyCodeLine{00833                     \mbox{\hyperlink{namespacehelper_aca849a924fa3ac396513505fe1cdfa2b}{helper::display\_vector}}(t, y.data(), \textcolor{stringliteral}{"y"});}
\DoxyCodeLine{00834 }
\DoxyCodeLine{00835                 \textcolor{comment}{//  Find the Babai point}}
\DoxyCodeLine{00836                 \textcolor{keywordflow}{for} (k1 = 0; k1 < t; k1++) \{}
\DoxyCodeLine{00837                     \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} c\_i = t -\/ k1, r\_kk = (c\_i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_1st -\/ 2 + c\_i)) -\/ 1;}
\DoxyCodeLine{00838                     \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} x\_est;}
\DoxyCodeLine{00839                     \textcolor{comment}{// 'Babai\_Gen:50' if i==t}}
\DoxyCodeLine{00840                     \textcolor{keywordflow}{if} (c\_i == t) \{}
\DoxyCodeLine{00841                         x\_est = y[c\_i -\/ 1] / R\_t[r\_kk];}
\DoxyCodeLine{00842                     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00843                         x\_est = 0.0;}
\DoxyCodeLine{00844                         \textcolor{keywordflow}{for} (i = 0; i < t -\/ c\_i; i++) \{}
\DoxyCodeLine{00845                             x\_est += R\_t[c\_i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_1st + c\_i + i -\/ 1) -\/ 1] * x\_tmp[(c\_i + cur\_1st + i) -\/ 1];}
\DoxyCodeLine{00846                         \}}
\DoxyCodeLine{00847                         x\_est = (y[c\_i -\/ 1] -\/ x\_est) / R\_t[r\_kk];}
\DoxyCodeLine{00848                     \}}
\DoxyCodeLine{00849                     x\_est = std::round(x\_est);}
\DoxyCodeLine{00850                     \textcolor{keywordflow}{if} (x\_est < 0.0) \{}
\DoxyCodeLine{00851                         x\_est = 0.0;}
\DoxyCodeLine{00852                     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (x\_est > upper) \{}
\DoxyCodeLine{00853                         x\_est = upper;}
\DoxyCodeLine{00854                     \}}
\DoxyCodeLine{00855                     x\_tmp[(c\_i + cur\_end -\/ t) -\/ 1] = x\_est;}
\DoxyCodeLine{00856                 \}}
\DoxyCodeLine{00857                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}})}
\DoxyCodeLine{00858                     \mbox{\hyperlink{namespacehelper_aca849a924fa3ac396513505fe1cdfa2b}{helper::display\_vector}}(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, x\_tmp.data(), \textcolor{stringliteral}{"x\_tmp"});}
\DoxyCodeLine{00859             \}}
\DoxyCodeLine{00860 }
\DoxyCodeLine{00861             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{00862                 helper::display\_vector<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, x\_tmp.data(), \textcolor{stringliteral}{"x\_tmp\_"} + std::to\_string(iter));}
\DoxyCodeLine{00863             \}}
\DoxyCodeLine{00864             \textcolor{comment}{// x\_tmp}}
\DoxyCodeLine{00865             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:84' v\_norm\_temp = norm(y\_a -\/ H\_P * x\_tmp);}}
\DoxyCodeLine{00866             v\_norm\_cur = \mbox{\hyperlink{namespacehelper_ad26b5d4b9e5c4d32f7de4fe3af8a7327}{helper::find\_residual}}(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, H\_P.data(), x\_tmp.data(), y\_a.data());}
\DoxyCodeLine{00867             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:86' if v\_norm\_temp < v\_norm}}
\DoxyCodeLine{00868             \textcolor{comment}{//            printf("v\_t:\%8.5f, v\_n:\%8.5f\(\backslash\)n", v\_norm\_temp, v\_norm);}}
\DoxyCodeLine{00869             \textcolor{keywordflow}{if} (v\_norm\_cur < v\_norm) \{}
\DoxyCodeLine{00870                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:87' x\_cur = x\_tmp;}}
\DoxyCodeLine{00871                 \textcolor{keywordflow}{for} (t = 0; t < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; t++) \{}
\DoxyCodeLine{00872                     x\_per[t] = x\_tmp[t];}
\DoxyCodeLine{00873                 \}}
\DoxyCodeLine{00874                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:88' v\_norm\_cur = v\_norm\_temp;}}
\DoxyCodeLine{00875                 \textcolor{comment}{//  v\_norm\_cur = v\_norm\_temp;}}
\DoxyCodeLine{00876                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:89' if per}}
\DoxyCodeLine{00877                 best\_per = per;}
\DoxyCodeLine{00878                 best\_piv.assign(Piv\_cum.begin(), Piv\_cum.end());}
\DoxyCodeLine{00879                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:94' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{00880                 \textcolor{keywordflow}{if} (v\_norm\_cur <= tolerance) \{}
\DoxyCodeLine{00881                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:95' stopping(2)=1;}}
\DoxyCodeLine{00882                     stopping[1] = 1;}
\DoxyCodeLine{00883                     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}} == 3)}
\DoxyCodeLine{00884                         iter = \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}};}
\DoxyCodeLine{00885                 \}}
\DoxyCodeLine{00886                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:99' v\_norm = v\_norm\_cur;}}
\DoxyCodeLine{00887                 v\_norm = v\_norm\_cur;}
\DoxyCodeLine{00888             \}}
\DoxyCodeLine{00889             \textcolor{comment}{// If we don't decrease the residual, keep trying permutations}}
\DoxyCodeLine{00890         \}}
\DoxyCodeLine{00891 }
\DoxyCodeLine{00892         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:44' P\_cur = P;}}
\DoxyCodeLine{00893         vector<scalar> P\_cur(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), P\_tmp(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{00894         \mbox{\hyperlink{namespacehelper_a05330a2b0997edb2c1d8304fb4ae78fd}{helper::eye}}(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_cur.data());}
\DoxyCodeLine{00895         \mbox{\hyperlink{namespacehelper_a05330a2b0997edb2c1d8304fb4ae78fd}{helper::eye}}(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_tmp.data());}
\DoxyCodeLine{00896         \textcolor{keywordflow}{if} (best\_per >= 0) \{}
\DoxyCodeLine{00897             \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; k1++) \{}
\DoxyCodeLine{00898                 \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{00899                     P\_cur[i + \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * k1] = P\_tmp[i + \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * (\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[best\_per][k1] -\/ 1)];}
\DoxyCodeLine{00900                 \}}
\DoxyCodeLine{00901             \}}
\DoxyCodeLine{00902         \}}
\DoxyCodeLine{00903 }
\DoxyCodeLine{00904         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:115' x\_cur = P\_cur * x\_cur;}}
\DoxyCodeLine{00905         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}})}
\DoxyCodeLine{00906             helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 1, x\_per.data(), \textcolor{stringliteral}{"x\_per"});}
\DoxyCodeLine{00907 }
\DoxyCodeLine{00908         x\_tmp.assign(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{00909         helper::mtimes\_Axy<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, best\_piv.data(), x\_per.data(), x\_tmp.data());}
\DoxyCodeLine{00910 }
\DoxyCodeLine{00911         x\_per.assign(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{00912         helper::mtimes\_Axy<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_cur.data(), x\_tmp.data(), x\_per.data());}
\DoxyCodeLine{00913 }
\DoxyCodeLine{00914         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{00915             x\_cur[i] = x\_per[i];}
\DoxyCodeLine{00916         \}}
\DoxyCodeLine{00917 }
\DoxyCodeLine{00918         time = omp\_get\_wtime() -\/ time;}
\DoxyCodeLine{00919 }
\DoxyCodeLine{00920         \textcolor{keywordflow}{return} \{stopping, time, v\_norm\_cur\};}
\DoxyCodeLine{00921     \}}
\DoxyCodeLine{00922 }
\DoxyCodeLine{00923 }
\DoxyCodeLine{00924     \textcolor{keyword}{template}<\textcolor{keyword}{typename} scalar, \textcolor{keyword}{typename} index, index m, index n>}
\DoxyCodeLine{00925     \mbox{\hyperlink{structcils_1_1return_type}{returnType<scalar, index>}}}
\DoxyCodeLine{\Hypertarget{cils__block__search_8cpp_source_l00926}\mbox{\hyperlink{classcils_1_1cils_a1bbc8793e2ee929d1b04dc4d9302994f}{00926}}     \mbox{\hyperlink{classcils_1_1cils}{cils<scalar, index, m, n>::cils\_scp\_block\_babai\_omp}}(vector<scalar> \&x\_cur, \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_norm\_cur,}
\DoxyCodeLine{00927                                                         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} n\_proc, \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} \mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}}) \{}
\DoxyCodeLine{00928         vector<scalar> R\_t(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), Q\_t(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), Piv\_cum(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{00929         \mbox{\hyperlink{namespacehelper_a05330a2b0997edb2c1d8304fb4ae78fd}{helper::eye}}(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, Piv\_cum.data());}
\DoxyCodeLine{00930 }
\DoxyCodeLine{00931         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:24' stopping=zeros(1,3);}}
\DoxyCodeLine{00932         vector<scalar> stopping(3, 0);}
\DoxyCodeLine{00933         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_norm = v\_norm\_cur;}
\DoxyCodeLine{00934         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:50' per = false;}}
\DoxyCodeLine{00935         vector<vector<scalar>> \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}(n\_proc, vector<scalar>(x\_cur)), best\_piv(n\_proc, vector<scalar>(Piv\_cum));}
\DoxyCodeLine{00936         vector<scalar> v\_norm\_cur\_proc(n\_proc, v\_norm);}
\DoxyCodeLine{00937         vector<index> best\_per\_proc(n\_proc, 0);}
\DoxyCodeLine{00938 }
\DoxyCodeLine{00939         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} time = omp\_get\_wtime();}
\DoxyCodeLine{00940         \textcolor{comment}{//  Subfunctions: SCP\_opt}}
\DoxyCodeLine{00941 }
\DoxyCodeLine{00942         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:25' b\_count = 0;}}
\DoxyCodeLine{00943         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} b\_count = 0;}
\DoxyCodeLine{00944         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} best\_proc = -\/1;}
\DoxyCodeLine{00945         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:27' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{00946         \textcolor{keywordflow}{if} (v\_norm\_cur <= tolerance) \{}
\DoxyCodeLine{00947             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:28' stopping(1)=1;}}
\DoxyCodeLine{00948             stopping[0] = 1;}
\DoxyCodeLine{00949             time = omp\_get\_wtime() -\/ time;}
\DoxyCodeLine{00950             \textcolor{keywordflow}{return} \{stopping, time, v\_norm\_cur\};}
\DoxyCodeLine{00951         \}}
\DoxyCodeLine{00952 }
\DoxyCodeLine{00953         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} cur\_1st, cur\_end, t, i, j, k1, best\_per = -\/1;}
\DoxyCodeLine{00954         vector<scalar> z, z\_z; \textcolor{comment}{//z\_z = Z * z;}}
\DoxyCodeLine{00955         vector<scalar> H\_P(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), x\_tmp(x\_cur), x\_per(x\_cur), y\_bar(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0), y(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{00956 }
\DoxyCodeLine{00957         time = omp\_get\_wtime();}
\DoxyCodeLine{00958 \textcolor{preprocessor}{\#pragma omp parallel default(shared) num\_threads(n\_proc) private(z, z\_z, cur\_1st, cur\_end, i, j, t, k1) firstprivate(R\_t, Q\_t, Piv\_cum, H\_P, x\_tmp, v\_norm, y\_bar, y)}}
\DoxyCodeLine{00959         \{}
\DoxyCodeLine{00960             \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} t\_num = omp\_get\_thread\_num(), per = -\/1;}
\DoxyCodeLine{00961             \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} start = omp\_get\_thread\_num() * \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} / n\_proc;}
\DoxyCodeLine{00962             \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} end = (omp\_get\_thread\_num() + 1) * \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} / n\_proc;}
\DoxyCodeLine{00963 }
\DoxyCodeLine{00964             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} itr = start; itr < end; itr++) \{}
\DoxyCodeLine{00965                 \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} iter = \mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}} ? rand() \% \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} : itr;}
\DoxyCodeLine{00966                 \textcolor{comment}{// H\_Apply permutation strategy to update x\_cur and v\_norm\_cur}}
\DoxyCodeLine{00967                 \textcolor{comment}{// [x\_tmp, v\_norm\_temp] = block\_opt(H\_P, y\_a, x\_tmp, n, indicator);}}
\DoxyCodeLine{00968                 \textcolor{comment}{// Corresponds to H\_Algorithm 12 (Block Optimal) in Report 10}}
\DoxyCodeLine{00969                 \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{00970                     \textcolor{keywordflow}{for} (j = 0; j < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; j++) \{}
\DoxyCodeLine{00971                         H\_P[j + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * i] = H[j + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[iter][i] -\/ 1)];}
\DoxyCodeLine{00972                     \}}
\DoxyCodeLine{00973                     x\_tmp[i] = x\_per[\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[iter][i] -\/ 1];}
\DoxyCodeLine{00974                 \}}
\DoxyCodeLine{00975 }
\DoxyCodeLine{00976                 R\_t.assign(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{00977                 Q\_t.assign(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{00978                 Piv\_cum.assign(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{00979                 cils\_partition\_deficient(x\_tmp.data(), Q\_t.data(), R\_t.data(), H\_P.data(), Piv\_cum.data());}
\DoxyCodeLine{00980 }
\DoxyCodeLine{00981                 per = iter;}
\DoxyCodeLine{00982                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:56' for j = 1:q}}
\DoxyCodeLine{00983                 \textcolor{keywordflow}{for} (j = 0; j < \mbox{\hyperlink{namespacecils_1_1program__def_a39e55918a5f7058c3f62ef2e96f26af3}{q}}; j++) \{}
\DoxyCodeLine{00984                     \textcolor{comment}{// 'Babai\_Gen:27' R = R\_t(:, indicator(1, j):indicator(2, j));}}
\DoxyCodeLine{00985                     cur\_1st = \mbox{\hyperlink{namespacecils_1_1program__def_ad90e6aae649723e9be8ab64efc945a42}{indicator}}[2 * j];}
\DoxyCodeLine{00986                     cur\_end = \mbox{\hyperlink{namespacecils_1_1program__def_ad90e6aae649723e9be8ab64efc945a42}{indicator}}[2 * j + 1];}
\DoxyCodeLine{00987                     \textcolor{comment}{//  Compute y\_bar}}
\DoxyCodeLine{00988                     \textcolor{comment}{// 'Babai\_Gen:39' if lastCol == n}}
\DoxyCodeLine{00989                     y\_bar.assign(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{00990                     \textcolor{keywordflow}{for} (k1 = 0; k1 <= cur\_1st -\/ 2; k1++) \{}
\DoxyCodeLine{00991                         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{00992                             t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{00993                             y\_bar[i] += H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * x\_tmp[k1];}
\DoxyCodeLine{00994                         \}}
\DoxyCodeLine{00995                     \}}
\DoxyCodeLine{00996                     \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} -\/ cur\_end; k1++) \{}
\DoxyCodeLine{00997                         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{00998                             t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{00999                             y\_bar[i] += H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_end + t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * x\_tmp[cur\_end + k1];}
\DoxyCodeLine{01000                         \}}
\DoxyCodeLine{01001                     \}}
\DoxyCodeLine{01002                     \textcolor{keywordflow}{for} (t = 0; t < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; t++) \{}
\DoxyCodeLine{01003                         y\_bar[t] = y\_a[t] -\/ y\_bar[t];}
\DoxyCodeLine{01004                     \}}
\DoxyCodeLine{01005 }
\DoxyCodeLine{01006                     \textcolor{comment}{// 'Babai\_Gen:46' y\_bar = Q' * y\_bar;}}
\DoxyCodeLine{01007                     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}})}
\DoxyCodeLine{01008                         \mbox{\hyperlink{namespacehelper_aca849a924fa3ac396513505fe1cdfa2b}{helper::display\_vector}}(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, y\_bar.data(), \textcolor{stringliteral}{"y\_bar"});}
\DoxyCodeLine{01009 }
\DoxyCodeLine{01010                     \textcolor{comment}{// 'Babai\_Gen:46' y\_bar = Q' * y\_bar;}}
\DoxyCodeLine{01011                     \textcolor{comment}{// Caution: Only use 1,t entry of the vector y.}}
\DoxyCodeLine{01012                     t = cur\_1st > cur\_end ? 0 : cur\_end -\/ cur\_1st + 1;}
\DoxyCodeLine{01013                     y.assign(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{01014                     \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; k1++) \{}
\DoxyCodeLine{01015                         \textcolor{keywordflow}{for} (i = 0; i < t; i++) \{}
\DoxyCodeLine{01016                             y[i] += Q\_t[k1 + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_1st -\/ 1 + i + k1 / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * y\_bar[k1];}
\DoxyCodeLine{01017                         \}}
\DoxyCodeLine{01018                     \}}
\DoxyCodeLine{01019 }
\DoxyCodeLine{01020                     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}})}
\DoxyCodeLine{01021                         \mbox{\hyperlink{namespacehelper_aca849a924fa3ac396513505fe1cdfa2b}{helper::display\_vector}}(t, y.data(), \textcolor{stringliteral}{"y"});}
\DoxyCodeLine{01022 }
\DoxyCodeLine{01023                     \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} p = 0; p < 6; p++) \{}
\DoxyCodeLine{01024 \textcolor{preprocessor}{\#pragma omp for schedule(dynamic) nowait}}
\DoxyCodeLine{01025                         \textcolor{keywordflow}{for} (k1 = 0; k1 < t; k1++) \{}
\DoxyCodeLine{01026                             \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} c\_i = t -\/ k1, r\_kk = (c\_i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_1st -\/ 2 + c\_i)) -\/ 1;}
\DoxyCodeLine{01027                             \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} x\_est;}
\DoxyCodeLine{01028                             \textcolor{comment}{// 'Babai\_Gen:50' if i==t}}
\DoxyCodeLine{01029                             \textcolor{keywordflow}{if} (c\_i == t) \{}
\DoxyCodeLine{01030                                 x\_est = y[c\_i -\/ 1] / R\_t[r\_kk];}
\DoxyCodeLine{01031                             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01032                                 x\_est = 0.0;}
\DoxyCodeLine{01033                                 \textcolor{keywordflow}{for} (i = 0; i < t -\/ c\_i; i++) \{}
\DoxyCodeLine{01034                                     x\_est +=}
\DoxyCodeLine{01035                                             R\_t[c\_i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_1st + c\_i + i -\/ 1) -\/ 1] * x\_tmp[(c\_i + cur\_1st + i) -\/ 1];}
\DoxyCodeLine{01036                                 \}}
\DoxyCodeLine{01037                                 x\_est = (y[c\_i -\/ 1] -\/ x\_est) / R\_t[r\_kk];}
\DoxyCodeLine{01038                             \}}
\DoxyCodeLine{01039                             x\_est = std::round(x\_est);}
\DoxyCodeLine{01040                             \textcolor{keywordflow}{if} (x\_est < 0.0) \{}
\DoxyCodeLine{01041                                 x\_est = 0.0;}
\DoxyCodeLine{01042                             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (x\_est > upper) \{}
\DoxyCodeLine{01043                                 x\_est = upper;}
\DoxyCodeLine{01044                             \}}
\DoxyCodeLine{01045                             x\_tmp[(c\_i + cur\_end -\/ t) -\/ 1] = x\_est;}
\DoxyCodeLine{01046                         \}}
\DoxyCodeLine{01047                     \}}
\DoxyCodeLine{01048                     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}})}
\DoxyCodeLine{01049                         \mbox{\hyperlink{namespacehelper_aca849a924fa3ac396513505fe1cdfa2b}{helper::display\_vector}}(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, x\_tmp.data(), \textcolor{stringliteral}{"x\_tmp"});}
\DoxyCodeLine{01050                 \}}
\DoxyCodeLine{01051 }
\DoxyCodeLine{01052                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{01053                     helper::display\_vector<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, x\_tmp.data(), \textcolor{stringliteral}{"x\_tmp\_"} + std::to\_string(iter));}
\DoxyCodeLine{01054                 \}}
\DoxyCodeLine{01055                 \textcolor{comment}{// x\_tmp}}
\DoxyCodeLine{01056                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:84' v\_norm\_temp = norm(y\_a -\/ H\_P * x\_tmp);}}
\DoxyCodeLine{01057                 v\_norm\_cur = \mbox{\hyperlink{namespacehelper_ad26b5d4b9e5c4d32f7de4fe3af8a7327}{helper::find\_residual}}(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, H\_P.data(), x\_tmp.data(), y\_a.data());}
\DoxyCodeLine{01058                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:86' if v\_norm\_temp < v\_norm}}
\DoxyCodeLine{01059                 \textcolor{comment}{//            printf("v\_t:\%8.5f, v\_n:\%8.5f\(\backslash\)n", v\_norm\_temp, v\_norm);}}
\DoxyCodeLine{01060                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:84' v\_norm\_temp = norm(y\_a -\/ H\_P * x\_tmp);}}
\DoxyCodeLine{01061                 v\_norm\_cur\_proc[t\_num] = \mbox{\hyperlink{namespacehelper_ad26b5d4b9e5c4d32f7de4fe3af8a7327}{helper::find\_residual}}(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, H\_P.data(), x\_tmp.data(), y\_a.data());}
\DoxyCodeLine{01062                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:86' if v\_norm\_temp < v\_norm}}
\DoxyCodeLine{01063                 \textcolor{keywordflow}{if} (v\_norm\_cur\_proc[t\_num] < v\_norm) \{}
\DoxyCodeLine{01064                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:87' x\_cur = x\_tmp;}}
\DoxyCodeLine{01065                     \textcolor{keywordflow}{for} (t = 0; t < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; t++) \{}
\DoxyCodeLine{01066                         x\_per[t] = x\_tmp[t];}
\DoxyCodeLine{01067                         \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}[t\_num][t] = x\_tmp[t];}
\DoxyCodeLine{01068                     \}}
\DoxyCodeLine{01069                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:89' if per}}
\DoxyCodeLine{01070                     best\_per\_proc[t\_num] = per;}
\DoxyCodeLine{01071                     best\_piv[t\_num].assign(Piv\_cum.begin(), Piv\_cum.end());}
\DoxyCodeLine{01072                     per = -\/1;}
\DoxyCodeLine{01073                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:94' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{01074                     \textcolor{keywordflow}{if} (v\_norm\_cur\_proc[t\_num] <= tolerance) \{}
\DoxyCodeLine{01075                         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:95' stopping(2)=1;}}
\DoxyCodeLine{01076                         stopping[1] = 1;}
\DoxyCodeLine{01077                         iter = \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}};}
\DoxyCodeLine{01078                         best\_proc = t\_num;}
\DoxyCodeLine{01079                     \}}
\DoxyCodeLine{01080                     v\_norm = v\_norm\_cur\_proc[t\_num];}
\DoxyCodeLine{01081                 \}}
\DoxyCodeLine{01082                 \textcolor{keywordflow}{if} (stopping[1])}
\DoxyCodeLine{01083                     iter = \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}};}
\DoxyCodeLine{01084                 \textcolor{comment}{// If we don't decrease the residual, keep trying permutations}}
\DoxyCodeLine{01085             \}}
\DoxyCodeLine{01086 }
\DoxyCodeLine{01087         \}}
\DoxyCodeLine{01088 }
\DoxyCodeLine{01089         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:44' P\_tmp = P;}}
\DoxyCodeLine{01090         vector<scalar> P\_cur(Piv\_cum), P\_tmp(Piv\_cum);}
\DoxyCodeLine{01091 }
\DoxyCodeLine{01092 }
\DoxyCodeLine{01093         \textcolor{keywordflow}{if} (best\_proc < 0) \{}
\DoxyCodeLine{01094             \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_min = INFINITY;}
\DoxyCodeLine{01095             \textcolor{keywordflow}{for} (k1 = 0; k1 < n\_proc; k1++) \{}
\DoxyCodeLine{01096                 \textcolor{keywordflow}{if} (v\_norm\_cur\_proc[k1] < v\_min) \{}
\DoxyCodeLine{01097                     v\_min = v\_norm\_cur\_proc[k1];}
\DoxyCodeLine{01098                     best\_proc = k1;}
\DoxyCodeLine{01099                 \}}
\DoxyCodeLine{01100             \}}
\DoxyCodeLine{01101         \}}
\DoxyCodeLine{01102 }
\DoxyCodeLine{01103         \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; k1++) \{}
\DoxyCodeLine{01104             \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{01105                 P\_cur[i + \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * k1] = P\_tmp[i + \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * (\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[best\_per\_proc[best\_proc]][k1] -\/ 1)];}
\DoxyCodeLine{01106             \}}
\DoxyCodeLine{01107         \}}
\DoxyCodeLine{01108 }
\DoxyCodeLine{01109         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:115' x\_cur = P\_cur * x\_cur;}}
\DoxyCodeLine{01110         vector<scalar> x\_a(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), x\_b(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{01111         helper::mtimes\_Axy<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, best\_piv[best\_proc].data(), \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}[best\_proc].data(), x\_a.data());}
\DoxyCodeLine{01112 }
\DoxyCodeLine{01113         helper::mtimes\_Axy<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_cur.data(), x\_a.data(), x\_b.data());}
\DoxyCodeLine{01114 }
\DoxyCodeLine{01115         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{01116             x\_cur[i] = x\_b[i];}
\DoxyCodeLine{01117         \}}
\DoxyCodeLine{01118 }
\DoxyCodeLine{01119         time = omp\_get\_wtime() -\/ time;}
\DoxyCodeLine{01120         \textcolor{keywordflow}{return} \{stopping, time, v\_norm\_cur\};}
\DoxyCodeLine{01121     \}}
\DoxyCodeLine{01122 }
\DoxyCodeLine{01123     \textcolor{keyword}{template}<\textcolor{keyword}{typename} scalar, \textcolor{keyword}{typename} index, index m, index n>}
\DoxyCodeLine{01124     \mbox{\hyperlink{structcils_1_1return_type}{returnType<scalar, index>}}}
\DoxyCodeLine{\Hypertarget{cils__block__search_8cpp_source_l01125}\mbox{\hyperlink{classcils_1_1cils_a304045d8f9ab3657d4fc5e5c54571226}{01125}}     \mbox{\hyperlink{classcils_1_1cils}{cils<scalar, index, m, n>::cils\_scp\_block\_optimal\_omp}}(vector<scalar> \&x\_cur, \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_norm\_cur,}
\DoxyCodeLine{01126                                                           \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} n\_proc, \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} \mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}}) \{}
\DoxyCodeLine{01127         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:24' stopping=zeros(1,3);}}
\DoxyCodeLine{01128         vector<scalar> stopping(3, 0);}
\DoxyCodeLine{01129 }
\DoxyCodeLine{01130         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} time = omp\_get\_wtime();}
\DoxyCodeLine{01131         \textcolor{comment}{//  Subfunctions: SCP\_opt}}
\DoxyCodeLine{01132 }
\DoxyCodeLine{01133         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:25' b\_count = 0;}}
\DoxyCodeLine{01134         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} b\_count = 0;}
\DoxyCodeLine{01135         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} best\_proc = -\/1;}
\DoxyCodeLine{01136         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:27' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{01137         \textcolor{keywordflow}{if} (v\_norm\_cur <= tolerance) \{}
\DoxyCodeLine{01138             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:28' stopping(1)=1;}}
\DoxyCodeLine{01139             stopping[0] = 1;}
\DoxyCodeLine{01140             time = omp\_get\_wtime() -\/ time;}
\DoxyCodeLine{01141             \textcolor{keywordflow}{return} \{\{\}, time, v\_norm\_cur\};}
\DoxyCodeLine{01142         \}}
\DoxyCodeLine{01143         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} cur\_1st, cur\_end, i, t, k1;}
\DoxyCodeLine{01144         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:32' q = ceil(n/m);}}
\DoxyCodeLine{01145         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:33' indicator = zeros(2, q);}}
\DoxyCodeLine{01146 }
\DoxyCodeLine{01147         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_norm = v\_norm\_cur;}
\DoxyCodeLine{01148         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:50' per = false;}}
\DoxyCodeLine{01149         vector<vector<scalar>> \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}(n\_proc, vector<scalar>(x\_cur));}
\DoxyCodeLine{01150         vector<scalar> v\_norm\_cur\_proc(n\_proc, v\_norm), x\_per(x\_cur);}
\DoxyCodeLine{01151         vector<index> best\_per\_proc(n\_proc, 0);}
\DoxyCodeLine{01152 }
\DoxyCodeLine{01153         \textcolor{comment}{// private variables}}
\DoxyCodeLine{01154         vector<scalar> z, z\_z; \textcolor{comment}{//z\_z = Z * z;}}
\DoxyCodeLine{01155         vector<scalar> H\_A, H\_P(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), x\_tmp(x\_cur), y\_bar(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0), y(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{01156 }
\DoxyCodeLine{01157         time = omp\_get\_wtime();}
\DoxyCodeLine{01158 \textcolor{preprocessor}{\#pragma omp parallel default(shared) num\_threads(n\_proc) private(z, z\_z, H\_A, cur\_1st, cur\_end, i, t, k1) firstprivate(H\_P, x\_tmp, v\_norm, y\_bar, y)}}
\DoxyCodeLine{01159         \{}
\DoxyCodeLine{01160             \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} t\_num = omp\_get\_thread\_num(), per = -\/1;}
\DoxyCodeLine{01161             \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} start = omp\_get\_thread\_num() * \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} / n\_proc;}
\DoxyCodeLine{01162             \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} end = (omp\_get\_thread\_num() + 1) * \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} / n\_proc;}
\DoxyCodeLine{01163 }
\DoxyCodeLine{01164             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} itr = start; itr < end; itr++) \{}
\DoxyCodeLine{01165                 \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} iter = \mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}} ? rand() \% \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} : itr;}
\DoxyCodeLine{01166                 \textcolor{comment}{// H\_Apply permutation strategy to update x\_cur and v\_norm\_cur}}
\DoxyCodeLine{01167                 \textcolor{comment}{// [x\_tmp, v\_norm\_temp] = block\_opt(H\_P, y\_a, x\_tmp, n, indicator);}}
\DoxyCodeLine{01168                 \textcolor{comment}{// Corresponds to H\_Algorithm 12 (Block Optimal) in Report 10}}
\DoxyCodeLine{01169                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:56' for j = 1:q}}
\DoxyCodeLine{01170                 \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; k1++) \{}
\DoxyCodeLine{01171                     \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{01172                         H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * k1] = H[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[iter][k1] -\/ 1)];}
\DoxyCodeLine{01173                     \}}
\DoxyCodeLine{01174                     x\_tmp[k1] = \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}[t\_num][\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[iter][k1] -\/ 1];}
\DoxyCodeLine{01175                 \}}
\DoxyCodeLine{01176                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:104' per = true;}}
\DoxyCodeLine{01177                 per = iter;}
\DoxyCodeLine{01178 }
\DoxyCodeLine{01179                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} j = 0; j < \mbox{\hyperlink{namespacecils_1_1program__def_a39e55918a5f7058c3f62ef2e96f26af3}{q}}; j++) \{}
\DoxyCodeLine{01180                     cur\_1st = \mbox{\hyperlink{namespacecils_1_1program__def_ad90e6aae649723e9be8ab64efc945a42}{indicator}}[2 * j];}
\DoxyCodeLine{01181                     cur\_end = \mbox{\hyperlink{namespacecils_1_1program__def_ad90e6aae649723e9be8ab64efc945a42}{indicator}}[2 * j + 1];}
\DoxyCodeLine{01182                     y\_bar.assign(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{01183                     \textcolor{keywordflow}{for} (k1 = 0; k1 <= cur\_1st -\/ 2; k1++) \{}
\DoxyCodeLine{01184                         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{01185                             t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{01186                             y\_bar[i] += H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * x\_tmp[k1];}
\DoxyCodeLine{01187                         \}}
\DoxyCodeLine{01188                     \}}
\DoxyCodeLine{01189                     \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} -\/ cur\_end; k1++) \{}
\DoxyCodeLine{01190                         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{01191                             t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{01192                             y\_bar[i] += H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_end + t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * x\_tmp[cur\_end + k1];}
\DoxyCodeLine{01193                         \}}
\DoxyCodeLine{01194                     \}}
\DoxyCodeLine{01195                     \textcolor{keywordflow}{for} (t = 0; t < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; t++) \{}
\DoxyCodeLine{01196                         y\_bar[t] = y\_a[t] -\/ y\_bar[t];}
\DoxyCodeLine{01197                     \}}
\DoxyCodeLine{01198                     t = cur\_end -\/ cur\_1st + 1;}
\DoxyCodeLine{01199                     H\_A.resize(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * t);}
\DoxyCodeLine{01200                     \textcolor{keywordflow}{for} (k1 = 0; k1 < t; k1++) \{}
\DoxyCodeLine{01201                         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{01202                             H\_A[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * k1] = H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_1st -\/ 1 + k1)];}
\DoxyCodeLine{01203                         \}}
\DoxyCodeLine{01204                     \}}
\DoxyCodeLine{01205                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:80' z = obils(H\_adj, y\_bar, l, u);}}
\DoxyCodeLine{01206                     z.resize(t);}
\DoxyCodeLine{01207                     z\_z.resize(t);}
\DoxyCodeLine{01208                     z.assign(t, 0);}
\DoxyCodeLine{01209                     z\_z.assign(t, 0);}
\DoxyCodeLine{01210 }
\DoxyCodeLine{01211                     \mbox{\hyperlink{classcils_1_1cils__reduction}{cils\_reduction<scalar, index>}} reduction(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, t, 0, upper, 0, 0);}
\DoxyCodeLine{01212                     reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_ae931950b0b3189911c26c286d27b4243}{cils\_obils\_reduction}}(H\_A, y\_bar);}
\DoxyCodeLine{01213 }
\DoxyCodeLine{01214                     \mbox{\hyperlink{classcils_1_1cils__search}{cils\_search<scalar, index>}} ils(t, t, this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}});}
\DoxyCodeLine{01215                     ils.\mbox{\hyperlink{classcils_1_1cils__search_a5ce0e601706b8cfb6454e27a659418f0}{obils\_search2}}(reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a14fa9ac8812783f80b56bf82a2170a70}{R\_Q}}, reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a866b4360c4e6f432154341330c6a77bb}{y\_q}}, z\_z);}
\DoxyCodeLine{01216 }
\DoxyCodeLine{01217                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:81' x\_tmp(cur\_1st:cur\_end) = 2 * z + e\_vec;}}
\DoxyCodeLine{01218                     \textcolor{keywordflow}{for} (i = 0; i < t; i++) \{}
\DoxyCodeLine{01219                         z[reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a579742eeb2f359ffcb7cb86725a7b65a}{p}}[i] -\/ 1] = z\_z[i];}
\DoxyCodeLine{01220                         \textcolor{comment}{//reduction.y\_q[i];//z\_z[reduction.p[i] -\/ 1];//2.0 * z\_z[i] + 1;}}
\DoxyCodeLine{01221                     \}}
\DoxyCodeLine{01222                     \textcolor{keywordflow}{for} (i = 0; i < t; i++) \{}
\DoxyCodeLine{01223                         x\_tmp[cur\_1st + i -\/ 1] = z[i];}
\DoxyCodeLine{01224                         \textcolor{comment}{//reduction.y\_q[i];//z\_z[reduction.p[i] -\/ 1];//2.0 * z\_z[i] + 1;}}
\DoxyCodeLine{01225                     \}}
\DoxyCodeLine{01226                 \}}
\DoxyCodeLine{01227 }
\DoxyCodeLine{01228                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:84' v\_norm\_temp = norm(y\_a -\/ H\_P * x\_tmp);}}
\DoxyCodeLine{01229                 v\_norm\_cur\_proc[t\_num] = \mbox{\hyperlink{namespacehelper_ad26b5d4b9e5c4d32f7de4fe3af8a7327}{helper::find\_residual}}(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, H\_P.data(), x\_tmp.data(), y\_a.data());}
\DoxyCodeLine{01230                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:86' if v\_norm\_temp < v\_norm}}
\DoxyCodeLine{01231                 \textcolor{keywordflow}{if} (v\_norm\_cur\_proc[t\_num] < v\_norm) \{}
\DoxyCodeLine{01232                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:87' x\_cur = x\_tmp;}}
\DoxyCodeLine{01233                     \textcolor{keywordflow}{for} (t = 0; t < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; t++) \{}
\DoxyCodeLine{01234                         x\_per[t] = x\_tmp[t];}
\DoxyCodeLine{01235                         \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}[t\_num][t] = x\_tmp[t];}
\DoxyCodeLine{01236                     \}}
\DoxyCodeLine{01237                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:89' if per}}
\DoxyCodeLine{01238                     best\_per\_proc[t\_num] = per;}
\DoxyCodeLine{01239                     per = -\/1;}
\DoxyCodeLine{01240                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:94' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{01241                     \textcolor{keywordflow}{if} (v\_norm\_cur\_proc[t\_num] <= tolerance) \{}
\DoxyCodeLine{01242                         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:95' stopping(2)=1;}}
\DoxyCodeLine{01243                         stopping[1] = 1;}
\DoxyCodeLine{01244                         iter = \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}};}
\DoxyCodeLine{01245                         best\_proc = t\_num;}
\DoxyCodeLine{01246                     \}}
\DoxyCodeLine{01247                     v\_norm = v\_norm\_cur\_proc[t\_num];}
\DoxyCodeLine{01248                 \}}
\DoxyCodeLine{01249                 \textcolor{keywordflow}{if} (stopping[1])}
\DoxyCodeLine{01250                     iter = \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}};}
\DoxyCodeLine{01251             \}}
\DoxyCodeLine{01252         \}}
\DoxyCodeLine{01253 }
\DoxyCodeLine{01254         vector<scalar> P\_cur(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), P\_tmp(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{01255         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:44' P\_tmp = eye(n);}}
\DoxyCodeLine{01256         helper::eye<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_tmp.data());}
\DoxyCodeLine{01257         helper::eye<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_cur.data());}
\DoxyCodeLine{01258         vector<scalar> x\_a(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{01259 }
\DoxyCodeLine{01260         \textcolor{keywordflow}{if} (best\_proc < 0) \{}
\DoxyCodeLine{01261             \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_min = INFINITY;}
\DoxyCodeLine{01262             \textcolor{keywordflow}{for} (k1 = 0; k1 < n\_proc; k1++) \{}
\DoxyCodeLine{01263                 \textcolor{keywordflow}{if} (v\_norm\_cur\_proc[k1] < v\_min) \{}
\DoxyCodeLine{01264                     v\_min = v\_norm\_cur\_proc[k1];}
\DoxyCodeLine{01265                     best\_proc = k1;}
\DoxyCodeLine{01266                 \}}
\DoxyCodeLine{01267             \}}
\DoxyCodeLine{01268         \}}
\DoxyCodeLine{01269 }
\DoxyCodeLine{01270         \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; k1++) \{}
\DoxyCodeLine{01271             \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{01272                 P\_cur[i + \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * k1] = P\_tmp[i + \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * (\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[best\_per\_proc[best\_proc]][k1] -\/ 1)];}
\DoxyCodeLine{01273             \}}
\DoxyCodeLine{01274         \}}
\DoxyCodeLine{01275 }
\DoxyCodeLine{01276         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:115' x\_cur = P\_cur * x\_cur;}}
\DoxyCodeLine{01277         helper::mtimes\_Axy<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_cur.data(), \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}[best\_proc].data(), x\_a.data());}
\DoxyCodeLine{01278         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{01279             x\_cur[i] = x\_a[i];}
\DoxyCodeLine{01280         \}}
\DoxyCodeLine{01281 }
\DoxyCodeLine{01282         time = omp\_get\_wtime() -\/ time;}
\DoxyCodeLine{01283         \textcolor{keywordflow}{return} \{stopping, time, v\_norm\};}
\DoxyCodeLine{01284     \}}
\DoxyCodeLine{01285 }
\DoxyCodeLine{01286     \textcolor{keyword}{template}<\textcolor{keyword}{typename} scalar, \textcolor{keyword}{typename} index, index m, index n>}
\DoxyCodeLine{01287     \mbox{\hyperlink{structcils_1_1return_type}{returnType<scalar, index>}}}
\DoxyCodeLine{\Hypertarget{cils__block__search_8cpp_source_l01288}\mbox{\hyperlink{classcils_1_1cils_a6f9f36385927e536ee2137ba66d14eef}{01288}}     \mbox{\hyperlink{classcils_1_1cils}{cils<scalar, index, m, n>::cils\_scp\_block\_suboptimal\_omp}}(vector<scalar> \&x\_cur, \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_norm\_cur,}
\DoxyCodeLine{01289                                                              \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} n\_proc, \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} \mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}}) \{}
\DoxyCodeLine{01290         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:24' stopping=zeros(1,3);}}
\DoxyCodeLine{01291         vector<scalar> stopping(3, 0);}
\DoxyCodeLine{01292 }
\DoxyCodeLine{01293         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} time = omp\_get\_wtime();}
\DoxyCodeLine{01294         \textcolor{comment}{//  Subfunctions: SCP\_opt}}
\DoxyCodeLine{01295 }
\DoxyCodeLine{01296         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:25' b\_count = 0;}}
\DoxyCodeLine{01297         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} b\_count = 0;}
\DoxyCodeLine{01298         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} best\_proc = -\/1;}
\DoxyCodeLine{01299         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:27' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{01300         \textcolor{keywordflow}{if} (v\_norm\_cur <= tolerance) \{}
\DoxyCodeLine{01301             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:28' stopping(1)=1;}}
\DoxyCodeLine{01302             stopping[0] = 1;}
\DoxyCodeLine{01303             time = omp\_get\_wtime() -\/ time;}
\DoxyCodeLine{01304             \textcolor{keywordflow}{return} \{\{\}, time, v\_norm\_cur\};}
\DoxyCodeLine{01305         \}}
\DoxyCodeLine{01306         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} cur\_1st, cur\_end, i, t, k1, n\_dx\_q\_2, n\_dx\_q\_0, check = 0;}
\DoxyCodeLine{01307         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} diff = 0, num\_iter = 0, flag = 0, temp;}
\DoxyCodeLine{01308 }
\DoxyCodeLine{01309         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:32' q = ceil(n/m);}}
\DoxyCodeLine{01310         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:33' indicator = zeros(2, q);}}
\DoxyCodeLine{01311 }
\DoxyCodeLine{01312         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_norm = v\_norm\_cur, sum;}
\DoxyCodeLine{01313         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:50' per = false;}}
\DoxyCodeLine{01314         vector<vector<scalar>> \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}(n\_proc, vector<scalar>(x\_cur));}
\DoxyCodeLine{01315         vector<scalar> v\_norm\_cur\_proc(n\_proc, v\_norm), x\_per(x\_cur);}
\DoxyCodeLine{01316         vector<index> best\_per\_proc(n\_proc, 0), R\_S\_1(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{01317 }
\DoxyCodeLine{01318         \textcolor{comment}{// private variables}}
\DoxyCodeLine{01319         vector<scalar> z(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), z\_z(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0); \textcolor{comment}{//z\_z = Z * z;}}
\DoxyCodeLine{01320         vector<scalar> H\_A, H\_P(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), x\_tmp(x\_cur), y\_bar(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0), y(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{01321 }
\DoxyCodeLine{01322         time = omp\_get\_wtime();}
\DoxyCodeLine{01323 \textcolor{preprocessor}{\#pragma omp parallel default(shared) num\_threads(n\_proc) private(sum, n\_dx\_q\_2, n\_dx\_q\_0, H\_A, cur\_1st, cur\_end, i, t, k1) firstprivate(check, z, z\_z, H\_P, x\_tmp, v\_norm, y\_bar, y)}}
\DoxyCodeLine{01324         \{}
\DoxyCodeLine{01325             \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} t\_num = omp\_get\_thread\_num(), per = -\/1;}
\DoxyCodeLine{01326             \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} start = omp\_get\_thread\_num() * \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} / n\_proc;}
\DoxyCodeLine{01327             \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} end = (omp\_get\_thread\_num() + 1) * \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} / n\_proc;}
\DoxyCodeLine{01328             \textcolor{comment}{//\#pragma omp for schedule(static, program\_def::chunk)}}
\DoxyCodeLine{01329             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} itr = start; itr < end; itr++) \{}
\DoxyCodeLine{01330 \textcolor{comment}{//            for (index itr = 0; itr < search\_iter; itr++) \{}}
\DoxyCodeLine{01331                 \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} iter = \mbox{\hyperlink{namespacecils_1_1program__def_a08664218f897245e14e3712203e03854}{mode}} ? rand() \% \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} : itr;}
\DoxyCodeLine{01332                 \textcolor{comment}{// H\_Apply permutation strategy to update x\_cur and v\_norm\_cur}}
\DoxyCodeLine{01333                 \textcolor{comment}{// [x\_tmp, v\_norm\_temp] = block\_opt(H\_P, y\_a, x\_tmp, n, indicator);}}
\DoxyCodeLine{01334                 \textcolor{comment}{// Corresponds to H\_Algorithm 12 (Block Optimal) in Report 10}}
\DoxyCodeLine{01335                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:56' for j = 1:q}}
\DoxyCodeLine{01336                 \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; k1++) \{}
\DoxyCodeLine{01337                     \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{01338                         H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * k1] = H[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[iter][k1] -\/ 1)];}
\DoxyCodeLine{01339                     \}}
\DoxyCodeLine{01340                     x\_tmp[k1] = \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}[t\_num][\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[iter][k1] -\/ 1];}
\DoxyCodeLine{01341                 \}}
\DoxyCodeLine{01342                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:104' per = true;}}
\DoxyCodeLine{01343                 per = iter;}
\DoxyCodeLine{01344 }
\DoxyCodeLine{01345                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} j = 0; j < \mbox{\hyperlink{namespacecils_1_1program__def_a39e55918a5f7058c3f62ef2e96f26af3}{q}}; j++) \{}
\DoxyCodeLine{01346                     cur\_1st = \mbox{\hyperlink{namespacecils_1_1program__def_ad90e6aae649723e9be8ab64efc945a42}{indicator}}[2 * j];}
\DoxyCodeLine{01347                     cur\_end = \mbox{\hyperlink{namespacecils_1_1program__def_ad90e6aae649723e9be8ab64efc945a42}{indicator}}[2 * j + 1];}
\DoxyCodeLine{01348                     y\_bar.assign(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{01349                     \textcolor{keywordflow}{for} (k1 = 0; k1 <= cur\_1st -\/ 2; k1++) \{}
\DoxyCodeLine{01350                         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{01351                             t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{01352                             y\_bar[i] += H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * x\_tmp[k1];}
\DoxyCodeLine{01353                         \}}
\DoxyCodeLine{01354                     \}}
\DoxyCodeLine{01355                     \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} -\/ cur\_end; k1++) \{}
\DoxyCodeLine{01356                         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{01357                             t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{01358                             y\_bar[i] += H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_end + t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * x\_tmp[cur\_end + k1];}
\DoxyCodeLine{01359                         \}}
\DoxyCodeLine{01360                     \}}
\DoxyCodeLine{01361                     \textcolor{keywordflow}{for} (t = 0; t < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; t++) \{}
\DoxyCodeLine{01362                         y\_bar[t] = y\_a[t] -\/ y\_bar[t];}
\DoxyCodeLine{01363                     \}}
\DoxyCodeLine{01364                     t = cur\_end -\/ cur\_1st + 1;}
\DoxyCodeLine{01365                     H\_A.resize(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * t);}
\DoxyCodeLine{01366                     \textcolor{keywordflow}{for} (k1 = 0; k1 < t; k1++) \{}
\DoxyCodeLine{01367                         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{01368                             H\_A[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * k1] = H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_1st -\/ 1 + k1)];}
\DoxyCodeLine{01369                         \}}
\DoxyCodeLine{01370                     \}}
\DoxyCodeLine{01371                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:80' z = obils(H\_adj, y\_bar, l, u);}}
\DoxyCodeLine{01372                     z.assign(t, 0);}
\DoxyCodeLine{01373                     z\_z.assign(t, 0);}
\DoxyCodeLine{01374 }
\DoxyCodeLine{01375                     \mbox{\hyperlink{classcils_1_1cils__reduction}{cils\_reduction<scalar, index>}} reduction(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, t, 0, upper, 0, 0);}
\DoxyCodeLine{01376                     reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_ae931950b0b3189911c26c286d27b4243}{cils\_obils\_reduction}}(H\_A, y\_bar);}
\DoxyCodeLine{01377 }
\DoxyCodeLine{01378                     \mbox{\hyperlink{classcils_1_1cils__search}{cils\_search<scalar, index>}} ils(t, t, this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}});}
\DoxyCodeLine{01379 }
\DoxyCodeLine{01380                     \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} ds = t / \mbox{\hyperlink{namespacecils_1_1program__def_a3a17b570cfa1a83160e8e2edb02c1e68}{block\_size}};}
\DoxyCodeLine{01381                     \textcolor{keywordflow}{if} (t \% \mbox{\hyperlink{namespacecils_1_1program__def_a3a17b570cfa1a83160e8e2edb02c1e68}{block\_size}} != 0 || ds == 1) \{}
\DoxyCodeLine{01382                         ils.\mbox{\hyperlink{classcils_1_1cils__search_a5ce0e601706b8cfb6454e27a659418f0}{obils\_search2}}(reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a14fa9ac8812783f80b56bf82a2170a70}{R\_Q}}, reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a866b4360c4e6f432154341330c6a77bb}{y\_q}}, z\_z);}
\DoxyCodeLine{01383                     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01384                         vector<index> d(ds, \mbox{\hyperlink{namespacecils_1_1program__def_a3a17b570cfa1a83160e8e2edb02c1e68}{block\_size}});}
\DoxyCodeLine{01385                         vector<scalar> y\_b(reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a866b4360c4e6f432154341330c6a77bb}{y\_q}});}
\DoxyCodeLine{01386                         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} s = d.size() -\/ 2; s >= 0; s-\/-\/) \{}
\DoxyCodeLine{01387                             d[s] += d[s + 1];}
\DoxyCodeLine{01388                         \}}
\DoxyCodeLine{01389                         R\_S\_1.assign(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{01390                         diff = flag = 0;}
\DoxyCodeLine{01391 }
\DoxyCodeLine{01392 \textcolor{comment}{//                        \#pragma omp barrier}}
\DoxyCodeLine{01393                         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} jj = 0; jj < 10; jj++) \{}
\DoxyCodeLine{01394 \textcolor{preprocessor}{\#pragma omp for schedule(dynamic) nowait}}
\DoxyCodeLine{01395                             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} s = 0; s < ds; s++) \{}
\DoxyCodeLine{01396 \textcolor{comment}{//                                if (!flag) \{}}
\DoxyCodeLine{01397                                     n\_dx\_q\_2 = d[s];}
\DoxyCodeLine{01398                                     n\_dx\_q\_0 = s == ds -\/ 1 ? 0 : d[s + 1];}
\DoxyCodeLine{01399 }
\DoxyCodeLine{01400                                     \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} row = n\_dx\_q\_0; row < n\_dx\_q\_2; row++) \{}
\DoxyCodeLine{01401                                         sum = 0;}
\DoxyCodeLine{01402                                         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} col = n\_dx\_q\_2; col < t; col++) \{}
\DoxyCodeLine{01403                                             sum += reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a14fa9ac8812783f80b56bf82a2170a70}{R\_Q}}[col * t + row] * z\_z[col];}
\DoxyCodeLine{01404                                         \}}
\DoxyCodeLine{01405                                         y\_b[row] = reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a866b4360c4e6f432154341330c6a77bb}{y\_q}}[row] -\/ sum;}
\DoxyCodeLine{01406                                     \}}
\DoxyCodeLine{01407 }
\DoxyCodeLine{01408                                     R\_S\_1[s] = ils.\mbox{\hyperlink{classcils_1_1cils__search_afbc108cdc3d8e1d47d3b2bb4513ce520}{obils\_search}}(n\_dx\_q\_0, n\_dx\_q\_2, 1, reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a14fa9ac8812783f80b56bf82a2170a70}{R\_Q}}.data(), y\_b.data(),}
\DoxyCodeLine{01409                                                                 z\_z);}
\DoxyCodeLine{01410 \textcolor{preprocessor}{\#pragma omp atomic}}
\DoxyCodeLine{01411                                     diff += R\_S\_1[s];}
\DoxyCodeLine{01412                                     flag = ((diff) >= ds) \&\& jj > 0;}
\DoxyCodeLine{01413 \textcolor{comment}{//                                \}}}
\DoxyCodeLine{01414                             \}}
\DoxyCodeLine{01415                         \}}
\DoxyCodeLine{01416                     \}}
\DoxyCodeLine{01417                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:81' x\_tmp(cur\_1st:cur\_end) = 2 * z + e\_vec;}}
\DoxyCodeLine{01418                     \textcolor{keywordflow}{for} (i = 0; i < t; i++) \{}
\DoxyCodeLine{01419                         z[reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a579742eeb2f359ffcb7cb86725a7b65a}{p}}[i] -\/ 1] = z\_z[i];}
\DoxyCodeLine{01420                         \textcolor{comment}{//reduction.y\_q[i];//z\_z[reduction.p[i] -\/ 1];//2.0 * z\_z[i] + 1;}}
\DoxyCodeLine{01421                     \}}
\DoxyCodeLine{01422                     \textcolor{keywordflow}{for} (i = 0; i < t; i++) \{}
\DoxyCodeLine{01423                         x\_tmp[cur\_1st + i -\/ 1] = z[i];}
\DoxyCodeLine{01424                         \textcolor{comment}{//reduction.y\_q[i];//z\_z[reduction.p[i] -\/ 1];//2.0 * z\_z[i] + 1;}}
\DoxyCodeLine{01425                     \}}
\DoxyCodeLine{01426                 \}}
\DoxyCodeLine{01427 }
\DoxyCodeLine{01428 }
\DoxyCodeLine{01429                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:84' v\_norm\_temp = norm(y\_a -\/ H\_P * x\_tmp);}}
\DoxyCodeLine{01430                 v\_norm\_cur\_proc[t\_num] = \mbox{\hyperlink{namespacehelper_ad26b5d4b9e5c4d32f7de4fe3af8a7327}{helper::find\_residual}}(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, H\_P.data(), x\_tmp.data(), y\_a.data());}
\DoxyCodeLine{01431                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:86' if v\_norm\_temp < v\_norm}}
\DoxyCodeLine{01432                 \textcolor{keywordflow}{if} (v\_norm\_cur\_proc[t\_num] < v\_norm) \{}
\DoxyCodeLine{01433                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:87' x\_cur = x\_tmp;}}
\DoxyCodeLine{01434                     \textcolor{keywordflow}{for} (t = 0; t < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; t++) \{}
\DoxyCodeLine{01435                         x\_per[t] = x\_tmp[t];}
\DoxyCodeLine{01436                         \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}[t\_num][t] = x\_tmp[t];}
\DoxyCodeLine{01437                     \}}
\DoxyCodeLine{01438                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:89' if per}}
\DoxyCodeLine{01439                     best\_per\_proc[t\_num] = per;}
\DoxyCodeLine{01440                     per = -\/1;}
\DoxyCodeLine{01441                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:94' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{01442                     \textcolor{keywordflow}{if} (v\_norm\_cur\_proc[t\_num] <= tolerance) \{}
\DoxyCodeLine{01443                         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:95' stopping(2)=1;}}
\DoxyCodeLine{01444                         stopping[1] = 1;}
\DoxyCodeLine{01445                         iter = \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}};}
\DoxyCodeLine{01446                         best\_proc = t\_num;}
\DoxyCodeLine{01447                     \}}
\DoxyCodeLine{01448                     v\_norm = v\_norm\_cur\_proc[t\_num];}
\DoxyCodeLine{01449                 \}}
\DoxyCodeLine{01450                 \textcolor{keywordflow}{if} (stopping[1])}
\DoxyCodeLine{01451                     iter = \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}};}
\DoxyCodeLine{01452             \}}
\DoxyCodeLine{01453         \}}
\DoxyCodeLine{01454 }
\DoxyCodeLine{01455         vector<scalar> P\_cur(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), P\_tmp(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{01456         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:44' P\_tmp = eye(n);}}
\DoxyCodeLine{01457         helper::eye<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_tmp.data());}
\DoxyCodeLine{01458         helper::eye<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_cur.data());}
\DoxyCodeLine{01459         vector<scalar> x\_a(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{01460 }
\DoxyCodeLine{01461         \textcolor{keywordflow}{if} (best\_proc < 0) \{}
\DoxyCodeLine{01462             \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} v\_min = INFINITY;}
\DoxyCodeLine{01463             \textcolor{keywordflow}{for} (k1 = 0; k1 < n\_proc; k1++) \{}
\DoxyCodeLine{01464                 \textcolor{keywordflow}{if} (v\_norm\_cur\_proc[k1] < v\_min) \{}
\DoxyCodeLine{01465                     v\_min = v\_norm\_cur\_proc[k1];}
\DoxyCodeLine{01466                     best\_proc = k1;}
\DoxyCodeLine{01467                 \}}
\DoxyCodeLine{01468             \}}
\DoxyCodeLine{01469         \}}
\DoxyCodeLine{01470         \textcolor{comment}{//        cout << best\_proc << " " << stopping[1] << " ";}}
\DoxyCodeLine{01471         \textcolor{comment}{//        helper::display\_vector<scalar, index>(n\_proc, v\_norm\_cur\_proc.data(), "v\_norm\_cur\_proc");}}
\DoxyCodeLine{01472         \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; k1++) \{}
\DoxyCodeLine{01473             \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{01474                 P\_cur[i + \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * k1] = P\_tmp[i + \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * (\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[best\_per\_proc[best\_proc]][k1] -\/ 1)];}
\DoxyCodeLine{01475             \}}
\DoxyCodeLine{01476         \}}
\DoxyCodeLine{01477 }
\DoxyCodeLine{01478         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:115' x\_cur = P\_cur * x\_cur;}}
\DoxyCodeLine{01479         helper::mtimes\_Axy<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_cur.data(), \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}[best\_proc].data(), x\_a.data());}
\DoxyCodeLine{01480         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{01481             x\_cur[i] = x\_a[i];}
\DoxyCodeLine{01482         \}}
\DoxyCodeLine{01483 }
\DoxyCodeLine{01484         time = omp\_get\_wtime() -\/ time;}
\DoxyCodeLine{01485         \textcolor{keywordflow}{return} \{stopping, time, v\_norm\};}
\DoxyCodeLine{01486     \}}
\DoxyCodeLine{01487 }
\DoxyCodeLine{01488     \textcolor{keyword}{template}<\textcolor{keyword}{typename} scalar, \textcolor{keyword}{typename} index, index m, index n>}
\DoxyCodeLine{01489     \mbox{\hyperlink{structcils_1_1return_type}{returnType<scalar, index>}}}
\DoxyCodeLine{\Hypertarget{cils__block__search_8cpp_source_l01490}\mbox{\hyperlink{classcils_1_1cils_aae9968bb8c29a427b736449e309fb0bb}{01490}}     \mbox{\hyperlink{classcils_1_1cils}{cils<scalar, index, m, n>::cils\_scp\_block\_optimal\_mpi}}(vector<scalar> \&x\_cur, \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} *v\_norm\_cur,}
\DoxyCodeLine{01491                                                           \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} size, \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} rank) \{}
\DoxyCodeLine{01492 }
\DoxyCodeLine{01493         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:24' stopping=zeros(1,3);}}
\DoxyCodeLine{01494         vector<scalar> stopping(3, 0);}
\DoxyCodeLine{01495 }
\DoxyCodeLine{01496         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} time = omp\_get\_wtime();}
\DoxyCodeLine{01497         \textcolor{comment}{//  Subfunctions: SCP\_opt}}
\DoxyCodeLine{01498         \mbox{\hyperlink{namespacecils_1_1program__def_a5a443b032763573934e651509da95505}{scalar}} flag = 0.0;}
\DoxyCodeLine{01499         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:25' b\_count = 0;}}
\DoxyCodeLine{01500         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:27' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{01501         \textcolor{keywordflow}{if} (v\_norm\_cur[0] <= tolerance) \{}
\DoxyCodeLine{01502             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:28' stopping(1)=1;}}
\DoxyCodeLine{01503             stopping[0] = 1;}
\DoxyCodeLine{01504             time = omp\_get\_wtime() -\/ time;}
\DoxyCodeLine{01505             \textcolor{keywordflow}{return} \{\{\}, time, v\_norm\_cur[0]\};}
\DoxyCodeLine{01506         \}}
\DoxyCodeLine{01507         \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} cur\_1st, cur\_end, i, t, k1, per = -\/1, best\_per = -\/1;}
\DoxyCodeLine{01508         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:32' q = ceil(n/m);}}
\DoxyCodeLine{01509         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:33' indicator = zeros(2, q);}}
\DoxyCodeLine{01510         \textcolor{keyword}{auto} v\_norm = (\textcolor{keywordtype}{double} *) malloc(2 * \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{01511         \textcolor{keyword}{auto} v\_norm\_rank = (\textcolor{keywordtype}{double} *) malloc(2 * \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{01512         v\_norm\_rank[0] = v\_norm\_cur[0];}
\DoxyCodeLine{01513         v\_norm[0] = v\_norm\_cur[0];}
\DoxyCodeLine{01514         v\_norm[1] = rank;}
\DoxyCodeLine{01515 }
\DoxyCodeLine{01516         vector<scalar> x\_per(x\_cur), \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{01517         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}}) \{}
\DoxyCodeLine{01518             cout << \textcolor{stringliteral}{"here: "} << rank * \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} / size << \textcolor{stringliteral}{","} << (rank + 1) * \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} / size << endl;}
\DoxyCodeLine{01519             \textcolor{keywordflow}{if} (rank != 0) \{}
\DoxyCodeLine{01520                 helper::display\_matrix<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, H.data(), \textcolor{stringliteral}{"H"} + to\_string(rank));}
\DoxyCodeLine{01521                 helper::display\_matrix<scalar, index>(1, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, \mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[0].data(), \textcolor{stringliteral}{"Per"} + to\_string(rank));}
\DoxyCodeLine{01522             \}}
\DoxyCodeLine{01523         \}}
\DoxyCodeLine{01524 }
\DoxyCodeLine{01525 \textcolor{comment}{//        index start = rank * search\_iter / size;}}
\DoxyCodeLine{01526 \textcolor{comment}{//        index end = (rank + 1) * search\_iter / size;}}
\DoxyCodeLine{01527 \textcolor{comment}{//        index slice = (end -\/ start) / program\_def::q;}}
\DoxyCodeLine{01528 \textcolor{comment}{//        index iter = start;}}
\DoxyCodeLine{01529 \textcolor{comment}{//        array<scalar, m * n> H\_P(H);}}
\DoxyCodeLine{01530         \textcolor{keywordflow}{if} (rank == 0)}
\DoxyCodeLine{01531             time = MPI\_Wtime();}
\DoxyCodeLine{01532 \textcolor{comment}{/*\#pragma omp parallel default(shared) num\_threads(program\_def::q) private(v\_norm\_cur, cur\_1st, cur\_end, i, t, k1, per)}}
\DoxyCodeLine{01533 \textcolor{comment}{        \{}}
\DoxyCodeLine{01534 \textcolor{comment}{            vector<scalar> H\_A, x\_tmp(x\_cur), y\_bar(m, 0), y(m, 0);}}
\DoxyCodeLine{01535 \textcolor{comment}{            vector<scalar> z, z\_z; //z\_z = Z * z;}}
\DoxyCodeLine{01536 \textcolor{comment}{            v\_norm\_cur = (double *) malloc(1 * sizeof(double));}}
\DoxyCodeLine{01537 \textcolor{comment}{            //v\_norm[0] = v\_norm\_rank[0];}}
\DoxyCodeLine{01538 \textcolor{comment}{}}
\DoxyCodeLine{01539 \textcolor{comment}{//            index t\_num = omp\_get\_thread\_num();}}
\DoxyCodeLine{01540 \textcolor{comment}{//            index t\_start = start + slice * t\_num;}}
\DoxyCodeLine{01541 \textcolor{comment}{//            index t\_end = start + slice * (t\_num + 1);}}
\DoxyCodeLine{01542 \textcolor{comment}{            while (iter < end) \{}}
\DoxyCodeLine{01543 \textcolor{comment}{                if (omp\_get\_thread\_num() == 0) \{}}
\DoxyCodeLine{01544 \textcolor{comment}{                    for (k1 = 0; k1 < n; k1++) \{}}
\DoxyCodeLine{01545 \textcolor{comment}{                        for (i = 0; i < m; i++) \{}}
\DoxyCodeLine{01546 \textcolor{comment}{                            H\_P[i + m * k1] = H[i + m * (permutation[iter][k1] -\/ 1)];}}
\DoxyCodeLine{01547 \textcolor{comment}{                        \}}}
\DoxyCodeLine{01548 \textcolor{comment}{                        x\_tmp[k1] = x\_per[permutation[iter][k1] -\/ 1];}}
\DoxyCodeLine{01549 \textcolor{comment}{                    \}}}
\DoxyCodeLine{01550 \textcolor{comment}{                    per = iter;}}
\DoxyCodeLine{01551 \textcolor{comment}{                \}}}
\DoxyCodeLine{01552 \textcolor{comment}{\#pragma omp barrier}}
\DoxyCodeLine{01553 \textcolor{comment}{                for (index inner = 0; inner < 4; inner++) \{}}
\DoxyCodeLine{01554 \textcolor{comment}{\#pragma omp for schedule(static, 1) nowait}}
\DoxyCodeLine{01555 \textcolor{comment}{                    for (index j = 0; j < q; j++) \{}}
\DoxyCodeLine{01556 \textcolor{comment}{//                        if (rank == 0 \&\& inner == 0)}}
\DoxyCodeLine{01557 \textcolor{comment}{//                            cout << omp\_get\_thread\_num() << " " << endl;}}
\DoxyCodeLine{01558 \textcolor{comment}{                        cur\_1st = indicator[2 * j];}}
\DoxyCodeLine{01559 \textcolor{comment}{                        cur\_end = indicator[2 * j + 1];}}
\DoxyCodeLine{01560 \textcolor{comment}{                        y\_bar.assign(m, 0);}}
\DoxyCodeLine{01561 \textcolor{comment}{                        for (k1 = 0; k1 <= cur\_1st -\/ 2; k1++) \{}}
\DoxyCodeLine{01562 \textcolor{comment}{                            for (i = 0; i < m; i++) \{}}
\DoxyCodeLine{01563 \textcolor{comment}{                                t = k1 * m + i;}}
\DoxyCodeLine{01564 \textcolor{comment}{                                y\_bar[i] += H\_P[i + m * (t / m)] * x\_tmp[k1];}}
\DoxyCodeLine{01565 \textcolor{comment}{                            \}}}
\DoxyCodeLine{01566 \textcolor{comment}{                        \}}}
\DoxyCodeLine{01567 \textcolor{comment}{                        for (k1 = 0; k1 < n -\/ cur\_end; k1++) \{}}
\DoxyCodeLine{01568 \textcolor{comment}{                            for (i = 0; i < m; i++) \{}}
\DoxyCodeLine{01569 \textcolor{comment}{                                t = k1 * m + i;}}
\DoxyCodeLine{01570 \textcolor{comment}{                                y\_bar[i] += H\_P[i + m * (cur\_end + t / m)] * x\_tmp[cur\_end + k1];}}
\DoxyCodeLine{01571 \textcolor{comment}{                            \}}}
\DoxyCodeLine{01572 \textcolor{comment}{                        \}}}
\DoxyCodeLine{01573 \textcolor{comment}{                        for (t = 0; t < m; t++) \{}}
\DoxyCodeLine{01574 \textcolor{comment}{                            y\_bar[t] = y\_a[t] -\/ y\_bar[t];}}
\DoxyCodeLine{01575 \textcolor{comment}{                        \}}}
\DoxyCodeLine{01576 \textcolor{comment}{                        t = cur\_end -\/ cur\_1st + 1;}}
\DoxyCodeLine{01577 \textcolor{comment}{                        H\_A.resize(m * t);}}
\DoxyCodeLine{01578 \textcolor{comment}{                        for (k1 = 0; k1 < t; k1++) \{}}
\DoxyCodeLine{01579 \textcolor{comment}{                            for (i = 0; i < m; i++) \{}}
\DoxyCodeLine{01580 \textcolor{comment}{                                H\_A[i + m * k1] = H\_P[i + m * (cur\_1st -\/ 1 + k1)];//2.0 *}}
\DoxyCodeLine{01581 \textcolor{comment}{                            \}}}
\DoxyCodeLine{01582 \textcolor{comment}{                        \}}}
\DoxyCodeLine{01583 \textcolor{comment}{                        // 'SCP\_Block\_Optimal\_2:80' z = obils(H\_adj, y\_bar, l, u);}}
\DoxyCodeLine{01584 \textcolor{comment}{                        z.resize(t);}}
\DoxyCodeLine{01585 \textcolor{comment}{                        z\_z.resize(t);}}
\DoxyCodeLine{01586 \textcolor{comment}{                        z.assign(t, 0);}}
\DoxyCodeLine{01587 \textcolor{comment}{                        z\_z.assign(t, 0);}}
\DoxyCodeLine{01588 \textcolor{comment}{}}
\DoxyCodeLine{01589 \textcolor{comment}{                        cils\_reduction<scalar, index> reduction(m, t, 0, upper, 0, 0);}}
\DoxyCodeLine{01590 \textcolor{comment}{                        reduction.cils\_obils\_reduction(H\_A, y\_bar);}}
\DoxyCodeLine{01591 \textcolor{comment}{}}
\DoxyCodeLine{01592 \textcolor{comment}{                        cils\_search<scalar, index> ils(t, t, this-\/>qam);}}
\DoxyCodeLine{01593 \textcolor{comment}{                        ils.obils\_search2(reduction.R\_Q, reduction.y\_q, z\_z);}}
\DoxyCodeLine{01594 \textcolor{comment}{}}
\DoxyCodeLine{01595 \textcolor{comment}{                        // 'SCP\_Block\_Optimal\_2:81' x\_tmp(cur\_1st:cur\_end) = 2 * z + e\_vec;}}
\DoxyCodeLine{01596 \textcolor{comment}{                        for (i = 0; i < t; i++) \{}}
\DoxyCodeLine{01597 \textcolor{comment}{                            z[reduction.p[i] -\/ 1] = z\_z[i];}}
\DoxyCodeLine{01598 \textcolor{comment}{                            //reduction.y\_q[i];//z\_z[reduction.p[i] -\/ 1];//2.0 * z\_z[i] + 1;}}
\DoxyCodeLine{01599 \textcolor{comment}{                        \}}}
\DoxyCodeLine{01600 \textcolor{comment}{                        for (i = 0; i < t; i++) \{}}
\DoxyCodeLine{01601 \textcolor{comment}{                            x\_tmp[cur\_1st + i -\/ 1] = z[i];}}
\DoxyCodeLine{01602 \textcolor{comment}{                            //reduction.y\_q[i];//z\_z[reduction.p[i] -\/ 1];//2.0 * z\_z[i] + 1;}}
\DoxyCodeLine{01603 \textcolor{comment}{                        \}}}
\DoxyCodeLine{01604 \textcolor{comment}{                    \}}}
\DoxyCodeLine{01605 \textcolor{comment}{                \}}}
\DoxyCodeLine{01606 \textcolor{comment}{}}
\DoxyCodeLine{01607 \textcolor{comment}{                if (omp\_get\_thread\_num() == 0) \{}}
\DoxyCodeLine{01608 \textcolor{comment}{                    iter++;}}
\DoxyCodeLine{01609 \textcolor{comment}{                    // x\_tmp}}
\DoxyCodeLine{01610 \textcolor{comment}{                    // 'SCP\_Block\_Optimal\_2:84' v\_norm\_temp = norm(y\_a -\/ H\_P * x\_tmp);}}
\DoxyCodeLine{01611 \textcolor{comment}{                    v\_norm\_cur[0] = helper::find\_residual<scalar, index>(m, n, H\_P.data(), x\_tmp.data(), y\_a.data());}}
\DoxyCodeLine{01612 \textcolor{comment}{                    // 'SCP\_Block\_Optimal\_2:86' if v\_norm\_temp < v\_norm}}
\DoxyCodeLine{01613 \textcolor{comment}{                    if (v\_norm\_cur[0] < v\_norm[0]) \{}}
\DoxyCodeLine{01614 \textcolor{comment}{                        // 'SCP\_Block\_Optimal\_2:87' x\_cur = x\_tmp;}}
\DoxyCodeLine{01615 \textcolor{comment}{                        for (t = 0; t < n; t++) \{}}
\DoxyCodeLine{01616 \textcolor{comment}{                            x\_per[t] = x\_tmp[t];}}
\DoxyCodeLine{01617 \textcolor{comment}{                        \}}}
\DoxyCodeLine{01618 \textcolor{comment}{                        // 'SCP\_Block\_Optimal\_2:88' v\_norm\_cur = v\_norm\_temp;}}
\DoxyCodeLine{01619 \textcolor{comment}{                        // 'SCP\_Block\_Optimal\_2:89' if per}}
\DoxyCodeLine{01620 \textcolor{comment}{                        best\_per = per;}}
\DoxyCodeLine{01621 \textcolor{comment}{                        per = -\/1;}}
\DoxyCodeLine{01622 \textcolor{comment}{                        // 'SCP\_Block\_Optimal\_2:94' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{01623 \textcolor{comment}{                        if (v\_norm\_cur[0] <= tolerance) \{}}
\DoxyCodeLine{01624 \textcolor{comment}{                            // 'SCP\_Block\_Optimal\_2:95' stopping(2)=1;}}
\DoxyCodeLine{01625 \textcolor{comment}{                            stopping[1] = 1;}}
\DoxyCodeLine{01626 \textcolor{comment}{                            iter = end;}}
\DoxyCodeLine{01627 \textcolor{comment}{                        \}}}
\DoxyCodeLine{01628 \textcolor{comment}{                        v\_norm[0] = v\_norm\_cur[0];}}
\DoxyCodeLine{01629 \textcolor{comment}{                    \}}}
\DoxyCodeLine{01630 \textcolor{comment}{                \}}}
\DoxyCodeLine{01631 \textcolor{comment}{\#pragma omp barrier}}
\DoxyCodeLine{01632 \textcolor{comment}{                if (stopping[1])}}
\DoxyCodeLine{01633 \textcolor{comment}{                    iter = end;}}
\DoxyCodeLine{01634 \textcolor{comment}{            \}}}
\DoxyCodeLine{01635 \textcolor{comment}{}}
\DoxyCodeLine{01636 \textcolor{comment}{        \}}}
\DoxyCodeLine{01637 \textcolor{comment}{        */}}
\DoxyCodeLine{01638 }
\DoxyCodeLine{01639 \textcolor{preprocessor}{\#pragma omp parallel default(shared) num\_threads(q) private(cur\_1st, cur\_end, i, t, k1)}}
\DoxyCodeLine{01640         \{}
\DoxyCodeLine{01641             vector<scalar> x\_tmp(x\_cur), y\_bar(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0), y(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{01642             array<scalar, m * n> H\_P(H);}
\DoxyCodeLine{01643             vector<scalar> H\_A, z, z\_z; \textcolor{comment}{//z\_z = Z * z;}}
\DoxyCodeLine{01644 \textcolor{comment}{//\#pragma omp for schedule(static, program\_def::chunk)}}
\DoxyCodeLine{01645             \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} t\_num = omp\_get\_thread\_num(), per = -\/1;}
\DoxyCodeLine{01646             \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} start = omp\_get\_thread\_num() * \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} / \mbox{\hyperlink{namespacecils_1_1program__def_a39e55918a5f7058c3f62ef2e96f26af3}{q}};}
\DoxyCodeLine{01647             \mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} end = (omp\_get\_thread\_num() + 1) * \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}} / \mbox{\hyperlink{namespacecils_1_1program__def_a39e55918a5f7058c3f62ef2e96f26af3}{q}};}
\DoxyCodeLine{01648             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} iter = start; iter < end; iter++) \{}
\DoxyCodeLine{01649                 \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; k1++) \{}
\DoxyCodeLine{01650                     \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{01651                         H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * k1] = H[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[iter][k1] -\/ 1)];}
\DoxyCodeLine{01652                     \}}
\DoxyCodeLine{01653                     x\_tmp[k1] = x\_per[\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[iter][k1] -\/ 1];}
\DoxyCodeLine{01654                 \}}
\DoxyCodeLine{01655                 per = iter;}
\DoxyCodeLine{01656 \textcolor{preprocessor}{\#pragma omp barrier}}
\DoxyCodeLine{01657                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} inner = 0; inner < 4; inner++) \{}
\DoxyCodeLine{01658 \textcolor{preprocessor}{\#pragma omp for schedule(dynamic) nowait}}
\DoxyCodeLine{01659                     \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacecils_1_1program__def_ade128bad84a8ce56a208e55d7eb2aa1c}{index}} j = 0; j < \mbox{\hyperlink{namespacecils_1_1program__def_a39e55918a5f7058c3f62ef2e96f26af3}{q}}; j++) \{}
\DoxyCodeLine{01660                         cur\_1st = \mbox{\hyperlink{namespacecils_1_1program__def_ad90e6aae649723e9be8ab64efc945a42}{indicator}}[2 * j];}
\DoxyCodeLine{01661                         cur\_end = \mbox{\hyperlink{namespacecils_1_1program__def_ad90e6aae649723e9be8ab64efc945a42}{indicator}}[2 * j + 1];}
\DoxyCodeLine{01662                         y\_bar.assign(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, 0);}
\DoxyCodeLine{01663                         \textcolor{keywordflow}{for} (k1 = 0; k1 <= cur\_1st -\/ 2; k1++) \{}
\DoxyCodeLine{01664                             \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{01665                                 t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{01666                                 y\_bar[i] += H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * x\_tmp[k1];}
\DoxyCodeLine{01667                             \}}
\DoxyCodeLine{01668                         \}}
\DoxyCodeLine{01669                         \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} -\/ cur\_end; k1++) \{}
\DoxyCodeLine{01670                             \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{01671                                 t = k1 * \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} + i;}
\DoxyCodeLine{01672                                 y\_bar[i] += H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_end + t / \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}})] * x\_tmp[cur\_end + k1];}
\DoxyCodeLine{01673                             \}}
\DoxyCodeLine{01674                         \}}
\DoxyCodeLine{01675                         \textcolor{keywordflow}{for} (t = 0; t < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; t++) \{}
\DoxyCodeLine{01676                             y\_bar[t] = y\_a[t] -\/ y\_bar[t];}
\DoxyCodeLine{01677                         \}}
\DoxyCodeLine{01678                         t = cur\_end -\/ cur\_1st + 1;}
\DoxyCodeLine{01679                         H\_A.resize(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * t);}
\DoxyCodeLine{01680                         \textcolor{keywordflow}{for} (k1 = 0; k1 < t; k1++) \{}
\DoxyCodeLine{01681                             \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}; i++) \{}
\DoxyCodeLine{01682                                 H\_A[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * k1] = H\_P[i + \mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}} * (cur\_1st -\/ 1 + k1)];\textcolor{comment}{//2.0 *}}
\DoxyCodeLine{01683                             \}}
\DoxyCodeLine{01684                         \}}
\DoxyCodeLine{01685                         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:80' z = obils(H\_adj, y\_bar, l, u);}}
\DoxyCodeLine{01686                         z.resize(t);}
\DoxyCodeLine{01687                         z\_z.resize(t);}
\DoxyCodeLine{01688                         z.assign(t, 0);}
\DoxyCodeLine{01689                         z\_z.assign(t, 0);}
\DoxyCodeLine{01690 }
\DoxyCodeLine{01691                         \mbox{\hyperlink{classcils_1_1cils__reduction}{cils\_reduction<scalar, index>}} reduction(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, t, 0, upper, 0, 0);}
\DoxyCodeLine{01692                         reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_ae931950b0b3189911c26c286d27b4243}{cils\_obils\_reduction}}(H\_A, y\_bar);}
\DoxyCodeLine{01693 }
\DoxyCodeLine{01694                         \mbox{\hyperlink{classcils_1_1cils__search}{cils\_search<scalar, index>}} ils(t, t, this-\/>\mbox{\hyperlink{namespacecils_1_1program__def_a3d3f108bbedbc57412eb97058fd02f4f}{qam}});}
\DoxyCodeLine{01695                         ils.\mbox{\hyperlink{classcils_1_1cils__search_a5ce0e601706b8cfb6454e27a659418f0}{obils\_search2}}(reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a14fa9ac8812783f80b56bf82a2170a70}{R\_Q}}, reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a866b4360c4e6f432154341330c6a77bb}{y\_q}}, z\_z);}
\DoxyCodeLine{01696 }
\DoxyCodeLine{01697                         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:81' x\_tmp(cur\_1st:cur\_end) = 2 * z + e\_vec;}}
\DoxyCodeLine{01698                         \textcolor{keywordflow}{for} (i = 0; i < t; i++) \{}
\DoxyCodeLine{01699                             z[reduction.\mbox{\hyperlink{classcils_1_1cils__reduction_a579742eeb2f359ffcb7cb86725a7b65a}{p}}[i] -\/ 1] = z\_z[i];}
\DoxyCodeLine{01700                             \textcolor{comment}{//reduction.y\_q[i];//z\_z[reduction.p[i] -\/ 1];//2.0 * z\_z[i] + 1;}}
\DoxyCodeLine{01701                         \}}
\DoxyCodeLine{01702                         \textcolor{keywordflow}{for} (i = 0; i < t; i++) \{}
\DoxyCodeLine{01703                             x\_tmp[cur\_1st + i -\/ 1] = z[i];}
\DoxyCodeLine{01704                             \textcolor{comment}{//reduction.y\_q[i];//z\_z[reduction.p[i] -\/ 1];//2.0 * z\_z[i] + 1;}}
\DoxyCodeLine{01705                         \}}
\DoxyCodeLine{01706                     \}}
\DoxyCodeLine{01707                 \}}
\DoxyCodeLine{01708                 v\_norm\_cur[0] = helper::find\_residual<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_aba60fb347ae24607d27482b95e00e2ad}{m}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, H\_P.data(), x\_tmp.data(), y\_a.data());}
\DoxyCodeLine{01709                 \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:86' if v\_norm\_temp < v\_norm}}
\DoxyCodeLine{01710                 \textcolor{keywordflow}{if} (v\_norm\_cur[0] < v\_norm[0]) \{}
\DoxyCodeLine{01711                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:87' x\_cur = x\_tmp;}}
\DoxyCodeLine{01712                     \textcolor{keywordflow}{for} (t = 0; t < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; t++) \{}
\DoxyCodeLine{01713                         x\_per[t] = x\_tmp[t];}
\DoxyCodeLine{01714                     \}}
\DoxyCodeLine{01715                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:88' v\_norm\_cur = v\_norm\_temp;}}
\DoxyCodeLine{01716                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:89' if per}}
\DoxyCodeLine{01717                     best\_per = per;}
\DoxyCodeLine{01718                     per = -\/1;}
\DoxyCodeLine{01719                     \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:94' if v\_norm\_cur <= tolerance}}
\DoxyCodeLine{01720                     \textcolor{keywordflow}{if} (v\_norm\_cur[0] <= tolerance) \{}
\DoxyCodeLine{01721                         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:95' stopping(2)=1;}}
\DoxyCodeLine{01722                         stopping[1] = 1;}
\DoxyCodeLine{01723                     \}}
\DoxyCodeLine{01724                     v\_norm[0] = v\_norm\_cur[0];}
\DoxyCodeLine{01725                 \}}
\DoxyCodeLine{01726                 \textcolor{keywordflow}{if} (stopping[1]) \{}
\DoxyCodeLine{01727                     iter = \mbox{\hyperlink{namespacecils_1_1program__def_a8cd622a2e5710eb4cae8ea311efdbb89}{search\_iter}};}
\DoxyCodeLine{01728                 \}}
\DoxyCodeLine{01729             \}}
\DoxyCodeLine{01730         \}}
\DoxyCodeLine{01731         \textcolor{comment}{// x\_tmp}}
\DoxyCodeLine{01732         \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:84' v\_norm\_temp = norm(y\_a -\/ H\_P * x\_tmp);}}
\DoxyCodeLine{01733 }
\DoxyCodeLine{01734         MPI\_Barrier(MPI\_COMM\_WORLD);}
\DoxyCodeLine{01735         MPI\_Allreduce(v\_norm, v\_norm\_rank, 1, MPI\_2DOUBLE\_PRECISION, MPI\_MINLOC, MPI\_COMM\_WORLD);}
\DoxyCodeLine{01736 }
\DoxyCodeLine{01737         \textcolor{keywordflow}{if} (rank == v\_norm\_rank[1]) \{}
\DoxyCodeLine{01738             vector<scalar> P\_cur(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0), P\_tmp(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, 0);}
\DoxyCodeLine{01739             \textcolor{comment}{// 'SCP\_Block\_Optimal\_2:44' P\_tmp = eye(n);}}
\DoxyCodeLine{01740             helper::eye<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_tmp.data());}
\DoxyCodeLine{01741             helper::eye<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_cur.data());}
\DoxyCodeLine{01742 }
\DoxyCodeLine{01743             \textcolor{keywordflow}{if} (best\_per >= 0) \{}
\DoxyCodeLine{01744                 \textcolor{keywordflow}{for} (k1 = 0; k1 < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; k1++) \{}
\DoxyCodeLine{01745                     \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{01746                         P\_cur[i + \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * k1] = P\_tmp[i + \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}} * (\mbox{\hyperlink{namespacecils_1_1program__def_a07ab6903c3955da2e6b581ded511413e}{permutation}}[best\_per][k1] -\/ 1)];}
\DoxyCodeLine{01747                     \}}
\DoxyCodeLine{01748                 \}}
\DoxyCodeLine{01749             \}}
\DoxyCodeLine{01750             \textcolor{comment}{//'SCP\_Block\_Optimal\_2:115' x\_cur = P\_cur * x\_cur;}}
\DoxyCodeLine{01751             helper::mtimes\_Axy<scalar, index>(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, P\_cur.data(), x\_per.data(), \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}.data());}
\DoxyCodeLine{01752             \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}; i++) \{}
\DoxyCodeLine{01753                 x\_cur[i] = \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}[i];}
\DoxyCodeLine{01754             \}}
\DoxyCodeLine{01755         \}}
\DoxyCodeLine{01756         MPI\_Barrier(MPI\_COMM\_WORLD);}
\DoxyCodeLine{01757         MPI\_Bcast(\&x\_cur[0], \mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, MPI\_DOUBLE, v\_norm\_rank[1], MPI\_COMM\_WORLD);}
\DoxyCodeLine{01758         \textcolor{keywordflow}{if} (rank == 0)}
\DoxyCodeLine{01759             time = MPI\_Wtime() -\/ time;}
\DoxyCodeLine{01760 }
\DoxyCodeLine{01761         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacecils_1_1program__def_a663ad9968c98aa091e879e89b37882c8}{verbose}})}
\DoxyCodeLine{01762             \mbox{\hyperlink{namespacehelper_aca849a924fa3ac396513505fe1cdfa2b}{helper::display\_vector}}(\mbox{\hyperlink{namespaceplot__helper_ae676d371d23b5326292ba89e470e00ec}{n}}, \mbox{\hyperlink{namespacepy__qr_a3c41c1fee6839cc452e15bf2f02a7d42}{x}}.data(), \textcolor{stringliteral}{"x:"} + std::to\_string(rank));}
\DoxyCodeLine{01763 }
\DoxyCodeLine{01764         \textcolor{keywordflow}{return} \{stopping, time, v\_norm[0]\};}
\DoxyCodeLine{01765     \}}
\DoxyCodeLine{01766 }
\DoxyCodeLine{01767 \}}
\DoxyCodeLine{01768 \textcolor{comment}{//                    if (front >= i \&\& end <= i) \{}}
\DoxyCodeLine{01769 \textcolor{comment}{//                        front++;}}
\DoxyCodeLine{01770 \textcolor{comment}{//                    if (!result[i] \&\& !flag)\{}}
\DoxyCodeLine{01771 \textcolor{comment}{//}}
\DoxyCodeLine{01772 \textcolor{comment}{//                    \}}}
\DoxyCodeLine{01773 }
\DoxyCodeLine{01774 \textcolor{comment}{//\#pragma omp simd collapse(2)}}
\DoxyCodeLine{01775 \textcolor{comment}{//                        if(j != 0) \{}}
\DoxyCodeLine{01776 \textcolor{comment}{//                        for (index row = n\_dx\_q\_0; row < n\_dx\_q\_1; row++) \{}}
\DoxyCodeLine{01778 \textcolor{comment}{}\textcolor{comment}{//                            row\_n += n -\/ row;}}
\DoxyCodeLine{01779 \textcolor{comment}{//                            sum = 0;}}
\DoxyCodeLine{01780 \textcolor{comment}{//                            for (index col = 0; col < i; col++) \{}}
\DoxyCodeLine{01781 \textcolor{comment}{//                                temp = i -\/ col -\/ 1; //Put values backwards}}
\DoxyCodeLine{01783 \textcolor{comment}{}\textcolor{comment}{//                                sum2 = 0;}}
\DoxyCodeLine{01784 \textcolor{comment}{//\#pragma omp simd reduction(+ : sum2)}}
\DoxyCodeLine{01785 \textcolor{comment}{//                                for (index l = n\_dx\_q\_1 + dx * col; l < n -\/ dx * temp; l++) \{}}
\DoxyCodeLine{01786 \textcolor{comment}{//                                    sum2 += R\_A[l + row\_n] * z\_x[l];}}
\DoxyCodeLine{01787 \textcolor{comment}{//                                \}}}
\DoxyCodeLine{01789 \textcolor{comment}{}\textcolor{comment}{//}}
\DoxyCodeLine{01790 \textcolor{comment}{//                                sum += sum2;}}
\DoxyCodeLine{01792 \textcolor{comment}{}\textcolor{comment}{//                                test += result[temp];}}
\DoxyCodeLine{01793 \textcolor{comment}{//                            \}}}
\DoxyCodeLine{01794 \textcolor{comment}{//                            y\_B[row] = y\_r[row] -\/ sum;}}
\DoxyCodeLine{01795 \textcolor{comment}{//                        \}}}
\DoxyCodeLine{01796 \textcolor{comment}{//                    if (first \&\& i > 1) \{// front >= i \&\& end <= i!}}
\DoxyCodeLine{01797 \textcolor{comment}{//                        n\_dx\_q\_2 = d-\/>at(i);}}
\DoxyCodeLine{01798 \textcolor{comment}{//                        n\_dx\_q\_0 = i == ds -\/ 1 ? 0 : d-\/>at(i + 1);}}
\DoxyCodeLine{01799 \textcolor{comment}{//}}
\DoxyCodeLine{01802 \textcolor{comment}{}\textcolor{comment}{//}}
\DoxyCodeLine{01803 \textcolor{comment}{//                        row\_n = (n\_dx\_q\_0 -\/ 1) * (n -\/ n\_dx\_q\_2 / 2);}}
\DoxyCodeLine{01804 \textcolor{comment}{//                        for (index row = n\_dx\_q\_0; row < n\_dx\_q\_2; row++) \{}}
\DoxyCodeLine{01805 \textcolor{comment}{//                            sum = 0;}}
\DoxyCodeLine{01806 \textcolor{comment}{//                            row\_n += n -\/ row;}}
\DoxyCodeLine{01807 \textcolor{comment}{//                            for (index col = n\_dx\_q\_2; col < n; col++) \{}}
\DoxyCodeLine{01808 \textcolor{comment}{//                                sum += R\_A[col + row\_n] * z\_x[col];}}
\DoxyCodeLine{01809 \textcolor{comment}{//                            \}}}
\DoxyCodeLine{01810 \textcolor{comment}{//                            y\_B[row] = y\_r[row] -\/ sum;}}
\DoxyCodeLine{01811 \textcolor{comment}{//                        \}}}
\DoxyCodeLine{01812 \textcolor{comment}{//                        ils.obils\_search\_omp(n\_dx\_q\_1, n\_dx\_q\_2, i, i == 0, R\_A, y\_B, z\_x);}}
\DoxyCodeLine{01813 \textcolor{comment}{//}}
\DoxyCodeLine{01814 \textcolor{comment}{//                        row\_n = (n\_dx\_q\_0 -\/ 1) * (n -\/ n\_dx\_q\_0 / 2);}}
\DoxyCodeLine{01815 \textcolor{comment}{//                        for (index row = n\_dx\_q\_0; row < n\_dx\_q\_1; row++) \{}}
\DoxyCodeLine{01816 \textcolor{comment}{//                            sum = 0;}}
\DoxyCodeLine{01817 \textcolor{comment}{//                            row\_n += n -\/ row;}}
\DoxyCodeLine{01818 \textcolor{comment}{//                            for (index col = n\_dx\_q\_1; col < n; col++) \{}}
\DoxyCodeLine{01819 \textcolor{comment}{//                                sum += R\_A[col + row\_n] * z\_x[col];}}
\DoxyCodeLine{01820 \textcolor{comment}{//                            \}}}
\DoxyCodeLine{01821 \textcolor{comment}{//                            y\_B[row] = y\_r[row] -\/ sum;}}
\DoxyCodeLine{01822 \textcolor{comment}{//                        \}}}
\DoxyCodeLine{01823 \textcolor{comment}{//                        ils.obils\_search\_omp(n\_dx\_q\_0, n\_dx\_q\_2, i, 0, R\_A, y\_B, z\_x);}}
\DoxyCodeLine{01824 \textcolor{comment}{//                    \} else}}
\DoxyCodeLine{01825 \textcolor{comment}{//                        for (index row = n\_dx\_q\_0; row < n\_dx\_q\_1; row++) \{}}
\DoxyCodeLine{01826 \textcolor{comment}{//                            row\_n += n -\/ row;}}
\DoxyCodeLine{01827 \textcolor{comment}{//                            sum = 0;}}
\DoxyCodeLine{01828 \textcolor{comment}{//\#pragma omp simd reduction(+ : sum)}}
\DoxyCodeLine{01829 \textcolor{comment}{//                            for (index col = n\_dx\_q\_1; col < n; col++) \{}}
\DoxyCodeLine{01830 \textcolor{comment}{//                                sum += R\_A[row\_n + col] * z\_x[col];}}
\DoxyCodeLine{01831 \textcolor{comment}{//                            \}}}
\DoxyCodeLine{01832 \textcolor{comment}{//                            y\_B[row] = sum;}}
\DoxyCodeLine{01833 \textcolor{comment}{//                        \}}}
\DoxyCodeLine{01834 \textcolor{comment}{//\#pragma omp simd}}
\DoxyCodeLine{01835 \textcolor{comment}{//                        for (index row = n\_dx\_q\_0; row < n\_dx\_q\_1; row++) \{}}
\DoxyCodeLine{01836 \textcolor{comment}{//                            row\_n += n -\/ row;}}
\DoxyCodeLine{01837 \textcolor{comment}{//                            y\_B[row] = 0;}}
\DoxyCodeLine{01838 \textcolor{comment}{//                            for (index col = n\_dx\_q\_1; col < n; col++) \{}}
\DoxyCodeLine{01839 \textcolor{comment}{//                                y\_B[row] += R\_A[row\_n + col] * z\_x[col];}}
\DoxyCodeLine{01840 \textcolor{comment}{//                            \}}}
\DoxyCodeLine{01841 \textcolor{comment}{//                        \}}}
\DoxyCodeLine{01842 \textcolor{comment}{//                        result[i] = ils\_search\_obils\_omp2(n\_dx\_q\_0, n\_dx\_q\_1, i, ds, y\_B, z\_x);}}
\DoxyCodeLine{01843 \textcolor{comment}{//void backup()\{}}
\DoxyCodeLine{01844 \textcolor{comment}{// for (index row = n\_dx\_q\_0; row < n\_dx\_q\_1; row++) \{}}
\DoxyCodeLine{01845 \textcolor{comment}{//     row\_n += n -\/ row;}}
\DoxyCodeLine{01846 \textcolor{comment}{//     y\_B[row] = 0;}}
\DoxyCodeLine{01847 \textcolor{comment}{//     for (index block = 0; block < i; block++) \{}}
\DoxyCodeLine{01848 \textcolor{comment}{//         R\_S[row * ds + block] = 0; //Put values backwards}}
\DoxyCodeLine{01849 \textcolor{comment}{//         for (index l = n -\/ dx * (i -\/ block); l < n -\/ dx * (i -\/ block -\/ 1); l++) \{}}
\DoxyCodeLine{01850 \textcolor{comment}{//             y\_B[row] += R\_A[l + row\_n] * z\_x[l];}}
\DoxyCodeLine{01852 \textcolor{comment}{}\textcolor{comment}{//         \}}}
\DoxyCodeLine{01854 \textcolor{comment}{}\textcolor{comment}{//     \}}}
\DoxyCodeLine{01855 \textcolor{comment}{//     z\_p[row] = z\_x[row];}}
\DoxyCodeLine{01856 \textcolor{comment}{// \}}}
\DoxyCodeLine{01857 \textcolor{comment}{//    row\_n = (n\_dx\_q\_1 -\/ 1) * (n -\/ n\_dx\_q\_1 / 2);}}
\DoxyCodeLine{01858 \textcolor{comment}{//    for (index row\_k = n\_dx\_q\_1 -\/ 1; row\_k >= n\_dx\_q\_0;) \{}}
\DoxyCodeLine{01859 \textcolor{comment}{//        y\_B[row\_k] = 0;}}
\DoxyCodeLine{01860 \textcolor{comment}{//        for (index block = 0; block < i; block++) \{}}
\DoxyCodeLine{01861 \textcolor{comment}{//            for (index l = n -\/ dx * (i -\/ block); l < n -\/ dx * (i -\/ block -\/ 1); l++) \{}}
\DoxyCodeLine{01862 \textcolor{comment}{//                y\_B[row\_k] += R\_A[l + row\_n] * z\_x[l];}}
\DoxyCodeLine{01864 \textcolor{comment}{}\textcolor{comment}{//            \}}}
\DoxyCodeLine{01865 \textcolor{comment}{//        \}}}
\DoxyCodeLine{01866 \textcolor{comment}{//        z\_p[row\_k] = z\_x[row\_k];}}
\DoxyCodeLine{01867 \textcolor{comment}{//        c[row\_k] = (y\_r[row\_k] -\/ y\_B[row\_k] -\/ sum[row\_k]) / R\_A[row\_n + row\_k];}}
\DoxyCodeLine{01868 \textcolor{comment}{//        temp = round(c[row\_k]);}}
\DoxyCodeLine{01869 \textcolor{comment}{//        z\_p[row\_k] = temp < 0 ? 0 : temp > upper ? upper : temp;}}
\DoxyCodeLine{01870 \textcolor{comment}{//        d[row\_k] = c[row\_k] > z\_p[row\_k] ? 1 : -\/1;}}
\DoxyCodeLine{01871 \textcolor{comment}{//}}
\DoxyCodeLine{01872 \textcolor{comment}{//        gamma = R\_A[row\_n + row\_k] * (c[row\_k] -\/ z\_p[row\_k]);}}
\DoxyCodeLine{01873 \textcolor{comment}{//        newprsd = p[row\_k] + gamma * gamma;}}
\DoxyCodeLine{01874 \textcolor{comment}{//}}
\DoxyCodeLine{01875 \textcolor{comment}{//        if (row\_k != n\_dx\_q\_0) \{}}
\DoxyCodeLine{01876 \textcolor{comment}{//            row\_k-\/-\/;}}
\DoxyCodeLine{01877 \textcolor{comment}{//            row\_n -\/= (n -\/ row\_k -\/ 1);}}
\DoxyCodeLine{01878 \textcolor{comment}{//            sum[row\_k] = 0;}}
\DoxyCodeLine{01879 \textcolor{comment}{//            for (index col = row\_k + 1; col < n\_dx\_q\_1; col++) \{}}
\DoxyCodeLine{01880 \textcolor{comment}{//                sum[row\_k] += R\_A[row\_n + col] * z\_p[col];}}
\DoxyCodeLine{01881 \textcolor{comment}{//            \}}}
\DoxyCodeLine{01882 \textcolor{comment}{//            p[row\_k] = newprsd;}}
\DoxyCodeLine{01883 \textcolor{comment}{//        \} else \{}}
\DoxyCodeLine{01884 \textcolor{comment}{//            break;}}
\DoxyCodeLine{01885 \textcolor{comment}{//        \}}}
\DoxyCodeLine{01886 \textcolor{comment}{//    \}}}
\DoxyCodeLine{01887 \textcolor{comment}{//\}}}
\DoxyCodeLine{01888 \textcolor{comment}{/*}}
\DoxyCodeLine{01889 \textcolor{comment}{ * index ds = d\_s-\/>size(), dx = d\_s-\/>at(ds -\/ 1);}}
\DoxyCodeLine{01890 \textcolor{comment}{        if (ds == 1 || ds == n) \{}}
\DoxyCodeLine{01891 \textcolor{comment}{            return cils\_block\_search\_serial(d\_s, z\_B);}}
\DoxyCodeLine{01892 \textcolor{comment}{        \}}}
\DoxyCodeLine{01893 \textcolor{comment}{}}
\DoxyCodeLine{01894 \textcolor{comment}{        auto z\_x = z\_B-\/>data();}}
\DoxyCodeLine{01895 \textcolor{comment}{        index upper = pow(2, qam) -\/ 1, n\_dx\_q\_0, n\_dx\_q\_1, z\_p[n], iter, dflag;}}
\DoxyCodeLine{01896 \textcolor{comment}{        index result[ds] = \{\}, diff = 0, info = 0, flag = 0, row\_n, row\_k, temp;}}
\DoxyCodeLine{01897 \textcolor{comment}{        scalar y\_B[n] = \{\}, R\_S[n * ds] = \{\}, sum[n] = \{\};}}
\DoxyCodeLine{01898 \textcolor{comment}{        scalar p[n] = \{\}, c[n] = \{\};}}
\DoxyCodeLine{01899 \textcolor{comment}{        index d[n] = \{\}, l[n] = \{\}, u[n] = \{\};}}
\DoxyCodeLine{01900 \textcolor{comment}{        scalar newprsd, gamma = 0, beta = INFINITY;}}
\DoxyCodeLine{01901 \textcolor{comment}{}}
\DoxyCodeLine{01902 \textcolor{comment}{        scalar run\_time = omp\_get\_wtime();}}
\DoxyCodeLine{01903 \textcolor{comment}{\#pragma omp parallel default(shared) num\_threads(1) private(n\_dx\_q\_0, n\_dx\_q\_1, row\_n, temp, row\_k, newprsd, gamma, beta, iter, dflag)}}
\DoxyCodeLine{01904 \textcolor{comment}{        \{}}
\DoxyCodeLine{01905 \textcolor{comment}{}}
\DoxyCodeLine{01906 \textcolor{comment}{            for (index j = 0; j < 1 \&\& !flag; j++) \{}}
\DoxyCodeLine{01907 \textcolor{comment}{//\#pragma omp for schedule(static, 1) nowait}}
\DoxyCodeLine{01908 \textcolor{comment}{                for (index i = 0; i < ds; i++) \{}}
\DoxyCodeLine{01909 \textcolor{comment}{//                    if (flag) continue;}}
\DoxyCodeLine{01910 \textcolor{comment}{                    n\_dx\_q\_0 = n -\/ (i + 1) * dx;}}
\DoxyCodeLine{01911 \textcolor{comment}{                    n\_dx\_q\_1 = n -\/ i * dx;}}
\DoxyCodeLine{01912 \textcolor{comment}{                    gamma = 0;}}
\DoxyCodeLine{01913 \textcolor{comment}{                    dflag = 1;}}
\DoxyCodeLine{01914 \textcolor{comment}{                    beta = INFINITY;}}
\DoxyCodeLine{01915 \textcolor{comment}{                    row\_n = (n\_dx\_q\_1 -\/ 1) * (n -\/ n\_dx\_q\_1 / 2);}}
\DoxyCodeLine{01916 \textcolor{comment}{                    row\_k = n\_dx\_q\_1 -\/ 1;for (; row\_k >= n\_dx\_q\_0;) \{}}
\DoxyCodeLine{01917 \textcolor{comment}{                        y\_B[row\_k] = 0;}}
\DoxyCodeLine{01918 \textcolor{comment}{                        for (index block = 0; block < i; block++) \{}}
\DoxyCodeLine{01919 \textcolor{comment}{                            for (index h = n -\/ dx * (i -\/ block); h < n -\/ dx * (i -\/ block -\/ 1); h++) \{}}
\DoxyCodeLine{01920 \textcolor{comment}{                                y\_B[row\_k] += R\_A[h + row\_n] * z\_x[h];}}
\DoxyCodeLine{01921 \textcolor{comment}{//                                R\_S[row * ds + block] += R\_A[l + row\_n] * z\_x[l];}}
\DoxyCodeLine{01922 \textcolor{comment}{                            \}}}
\DoxyCodeLine{01923 \textcolor{comment}{                        \}}}
\DoxyCodeLine{01924 \textcolor{comment}{                        z\_p[row\_k] = z\_x[row\_k];}}
\DoxyCodeLine{01925 \textcolor{comment}{                        c[row\_k] = (y\_r[row\_k] -\/ y\_B[row\_k] -\/ sum[row\_k]) / R\_A[row\_n + row\_k];}}
\DoxyCodeLine{01926 \textcolor{comment}{                        z\_p[row\_k] = round(c[row\_k]);}}
\DoxyCodeLine{01927 \textcolor{comment}{                        if (z\_p[row\_k] <= 0) \{}}
\DoxyCodeLine{01928 \textcolor{comment}{                            z\_p[row\_k] = u[row\_k] = 0; //The lower bound is reached}}
\DoxyCodeLine{01929 \textcolor{comment}{                            l[row\_k] = d[row\_k] = 1;}}
\DoxyCodeLine{01930 \textcolor{comment}{                        \} else if (z\_p[row\_k] >= upper) \{}}
\DoxyCodeLine{01931 \textcolor{comment}{                            z\_p[row\_k] = upper; //The upper bound is reached}}
\DoxyCodeLine{01932 \textcolor{comment}{                            u[row\_k] = 1;}}
\DoxyCodeLine{01933 \textcolor{comment}{                            l[row\_k] = 0;}}
\DoxyCodeLine{01934 \textcolor{comment}{                            d[row\_k] = -\/1;}}
\DoxyCodeLine{01935 \textcolor{comment}{                        \} else \{}}
\DoxyCodeLine{01936 \textcolor{comment}{                            l[row\_k] = u[row\_k] = 0;}}
\DoxyCodeLine{01937 \textcolor{comment}{                            //  Determine enumeration direction at level block\_size}}
\DoxyCodeLine{01938 \textcolor{comment}{                            d[row\_k] = c[row\_k] > z\_p[row\_k] ? 1 : -\/1;}}
\DoxyCodeLine{01939 \textcolor{comment}{                        \}    gamma = R\_A[row\_n + row\_k] * (c[row\_k] -\/ z\_p[row\_k]);}}
\DoxyCodeLine{01940 \textcolor{comment}{                        newprsd = p[row\_k] + gamma * gamma;    if (row\_k != n\_dx\_q\_0) \{}}
\DoxyCodeLine{01941 \textcolor{comment}{                            row\_k-\/-\/;}}
\DoxyCodeLine{01942 \textcolor{comment}{                            row\_n -\/= (n -\/ row\_k -\/ 1);}}
\DoxyCodeLine{01943 \textcolor{comment}{                            sum[row\_k] = 0;}}
\DoxyCodeLine{01944 \textcolor{comment}{                            for (index col = row\_k + 1; col < n\_dx\_q\_1; col++) \{}}
\DoxyCodeLine{01945 \textcolor{comment}{                                sum[row\_k] += R\_A[row\_n + col] * z\_p[col];}}
\DoxyCodeLine{01946 \textcolor{comment}{                            \}}}
\DoxyCodeLine{01947 \textcolor{comment}{                            p[row\_k] = newprsd;}}
\DoxyCodeLine{01948 \textcolor{comment}{                        \} else \{}}
\DoxyCodeLine{01949 \textcolor{comment}{                            break;}}
\DoxyCodeLine{01950 \textcolor{comment}{                        \}}}
\DoxyCodeLine{01951 \textcolor{comment}{                    \}}}
\DoxyCodeLine{01952 \textcolor{comment}{}}
\DoxyCodeLine{01953 \textcolor{comment}{//                    row\_n = (n\_dx\_q\_1 -\/ 1) * (n -\/ n\_dx\_q\_1 / 2);}}
\DoxyCodeLine{01954 \textcolor{comment}{//                    row\_k = n\_dx\_q\_1 -\/ 1;}}
\DoxyCodeLine{01955 \textcolor{comment}{//                    gamma = 0;}}
\DoxyCodeLine{01956 \textcolor{comment}{//                    dflag = 1;}}
\DoxyCodeLine{01957 \textcolor{comment}{//                    beta = INFINITY;}}
\DoxyCodeLine{01958 \textcolor{comment}{}}
\DoxyCodeLine{01959 \textcolor{comment}{//                    for (index count = 0; count < program\_def::max\_search || iter == 0; count++) \{}}
\DoxyCodeLine{01960 \textcolor{comment}{                    while (true) \{}}
\DoxyCodeLine{01961 \textcolor{comment}{                        if (dflag) \{}}
\DoxyCodeLine{01962 \textcolor{comment}{                            newprsd = p[row\_k] + gamma * gamma;}}
\DoxyCodeLine{01963 \textcolor{comment}{                            if (newprsd < beta) \{}}
\DoxyCodeLine{01964 \textcolor{comment}{                                if (row\_k != n\_dx\_q\_0) \{}}
\DoxyCodeLine{01965 \textcolor{comment}{                                    row\_k-\/-\/;}}
\DoxyCodeLine{01966 \textcolor{comment}{                                    row\_n -\/= (n -\/ row\_k -\/ 1);}}
\DoxyCodeLine{01967 \textcolor{comment}{                                    p[row\_k] = newprsd;}}
\DoxyCodeLine{01968 \textcolor{comment}{                                    c[row\_k] = (y\_r[row\_k] -\/ y\_B[row\_k] -\/ sum[row\_k]) / R\_A[row\_n + row\_k];}}
\DoxyCodeLine{01969 \textcolor{comment}{                                    z\_p[row\_k] = round(c[row\_k]);}}
\DoxyCodeLine{01970 \textcolor{comment}{                                    if (z\_p[row\_k] <= 0) \{}}
\DoxyCodeLine{01971 \textcolor{comment}{                                        z\_p[row\_k] = u[row\_k] = 0;}}
\DoxyCodeLine{01972 \textcolor{comment}{                                        l[row\_k] = d[row\_k] = 1;}}
\DoxyCodeLine{01973 \textcolor{comment}{                                    \} else if (z\_p[row\_k] >= upper) \{}}
\DoxyCodeLine{01974 \textcolor{comment}{                                        z\_p[row\_k] = upper;}}
\DoxyCodeLine{01975 \textcolor{comment}{                                        u[row\_k] = 1;}}
\DoxyCodeLine{01976 \textcolor{comment}{                                        l[row\_k] = 0;}}
\DoxyCodeLine{01977 \textcolor{comment}{                                        d[row\_k] = -\/1;}}
\DoxyCodeLine{01978 \textcolor{comment}{                                    \} else \{}}
\DoxyCodeLine{01979 \textcolor{comment}{                                        l[row\_k] = u[row\_k] = 0;}}
\DoxyCodeLine{01980 \textcolor{comment}{                                        d[row\_k] = c[row\_k] > z\_p[row\_k] ? 1 : -\/1;}}
\DoxyCodeLine{01981 \textcolor{comment}{                                    \}}}
\DoxyCodeLine{01982 \textcolor{comment}{                                    gamma = R\_A[row\_n + row\_k] * (c[row\_k] -\/ z\_p[row\_k]);}}
\DoxyCodeLine{01983 \textcolor{comment}{                                \} else \{}}
\DoxyCodeLine{01984 \textcolor{comment}{                                    beta = newprsd;}}
\DoxyCodeLine{01985 \textcolor{comment}{                                    diff = 0;}}
\DoxyCodeLine{01986 \textcolor{comment}{//                                    iter++;}}
\DoxyCodeLine{01987 \textcolor{comment}{\#pragma omp simd}}
\DoxyCodeLine{01988 \textcolor{comment}{                                    for (index h = n\_dx\_q\_0; h < n\_dx\_q\_1; h++) \{}}
\DoxyCodeLine{01989 \textcolor{comment}{                                        diff += z\_x[h] == z\_p[h];}}
\DoxyCodeLine{01990 \textcolor{comment}{                                        z\_x[h] = z\_p[h];}}
\DoxyCodeLine{01991 \textcolor{comment}{                                    \}}}
\DoxyCodeLine{01992 \textcolor{comment}{}}
\DoxyCodeLine{01993 \textcolor{comment}{//                                    if (iter > program\_def::search\_iter || diff == dx) \{}}
\DoxyCodeLine{01994 \textcolor{comment}{//                                        break;}}
\DoxyCodeLine{01995 \textcolor{comment}{//                                    \}}}
\DoxyCodeLine{01996 \textcolor{comment}{                                \}}}
\DoxyCodeLine{01997 \textcolor{comment}{                            \} else \{}}
\DoxyCodeLine{01998 \textcolor{comment}{                                dflag = 0;}}
\DoxyCodeLine{01999 \textcolor{comment}{                            \}    \} else \{}}
\DoxyCodeLine{02000 \textcolor{comment}{                            if (row\_k == n\_dx\_q\_1 -\/ 1) break;}}
\DoxyCodeLine{02001 \textcolor{comment}{                            else \{}}
\DoxyCodeLine{02002 \textcolor{comment}{                                row\_k++;}}
\DoxyCodeLine{02003 \textcolor{comment}{                                row\_n += n -\/ row\_k;}}
\DoxyCodeLine{02004 \textcolor{comment}{                                if (l[row\_k] != 1 || u[row\_k] != 1) \{}}
\DoxyCodeLine{02005 \textcolor{comment}{                                    z\_p[row\_k] += d[row\_k];}}
\DoxyCodeLine{02006 \textcolor{comment}{                                    sum[row\_k] += R\_A[row\_n + row\_k] * d[row\_k];}}
\DoxyCodeLine{02007 \textcolor{comment}{                                    if (z\_p[row\_k] == 0) \{}}
\DoxyCodeLine{02008 \textcolor{comment}{                                        l[row\_k] = 1;}}
\DoxyCodeLine{02009 \textcolor{comment}{                                        d[row\_k] = -\/d[row\_k] + 1;}}
\DoxyCodeLine{02010 \textcolor{comment}{                                    \} else if (z\_p[row\_k] == upper) \{}}
\DoxyCodeLine{02011 \textcolor{comment}{                                        u[row\_k] = 1;}}
\DoxyCodeLine{02012 \textcolor{comment}{                                        d[row\_k] = -\/d[row\_k] -\/ 1;}}
\DoxyCodeLine{02013 \textcolor{comment}{                                    \} else if (l[row\_k] == 1) \{}}
\DoxyCodeLine{02014 \textcolor{comment}{                                        d[row\_k] = 1;}}
\DoxyCodeLine{02015 \textcolor{comment}{                                    \} else if (u[row\_k] == 1) \{}}
\DoxyCodeLine{02016 \textcolor{comment}{                                        d[row\_k] = -\/1;}}
\DoxyCodeLine{02017 \textcolor{comment}{                                    \} else \{}}
\DoxyCodeLine{02018 \textcolor{comment}{                                        d[row\_k] = d[row\_k] > 0 ? -\/d[row\_k] -\/ 1 : -\/d[row\_k] + 1;}}
\DoxyCodeLine{02019 \textcolor{comment}{                                    \}}}
\DoxyCodeLine{02020 \textcolor{comment}{                                    gamma = R\_A[row\_n + row\_k] * (c[row\_k] -\/ z\_p[row\_k]);}}
\DoxyCodeLine{02021 \textcolor{comment}{                                    dflag = 1;}}
\DoxyCodeLine{02022 \textcolor{comment}{                                \}}}
\DoxyCodeLine{02023 \textcolor{comment}{                            \}}}
\DoxyCodeLine{02024 \textcolor{comment}{                        \}}}
\DoxyCodeLine{02025 \textcolor{comment}{                    \}}}
\DoxyCodeLine{02026 \textcolor{comment}{//ILS search process}}
\DoxyCodeLine{02027 \textcolor{comment}{//                        for (index count = 0; count < program\_def::max\_search || iter == 0; count++) \{}}
\DoxyCodeLine{02028 \textcolor{comment}{//}}
\DoxyCodeLine{02029 \textcolor{comment}{//                        \}}}
\DoxyCodeLine{02030 \textcolor{comment}{//}}
\DoxyCodeLine{02031 \textcolor{comment}{//                        result[i] = diff == dx;}}
\DoxyCodeLine{02032 \textcolor{comment}{//                        if (!result[i]) \{}}
\DoxyCodeLine{02033 \textcolor{comment}{//                        for (index h = 0; h < dx; h++) \{}}
\DoxyCodeLine{02034 \textcolor{comment}{//                            index col = h + n\_dx\_q\_0;}}
\DoxyCodeLine{02035 \textcolor{comment}{//                            if (z\_p[col] != x[h]) \{}}
\DoxyCodeLine{02036 \textcolor{comment}{//                                for (index row = 0; row < ds -\/ i -\/ 1; row++) \{}}
\DoxyCodeLine{02037 \textcolor{comment}{//                                    for (index hh = 0; hh < dx; hh++) \{}}
\DoxyCodeLine{02038 \textcolor{comment}{//                                        temp = row * dx + hh;}}
\DoxyCodeLine{02039 \textcolor{comment}{//                                        row\_n = (n * temp) -\/ ((temp * (temp + 1)) / 2);}}
\DoxyCodeLine{02040 \textcolor{comment}{//                                        R\_S[temp * ds + i] -\/= R\_A[row\_n + col] * (z\_p[h] -\/ z\_x[col]);}}
\DoxyCodeLine{02041 \textcolor{comment}{//                                    \}}}
\DoxyCodeLine{02042 \textcolor{comment}{//                                \}}}
\DoxyCodeLine{02044 \textcolor{comment}{//                            \}}}
\DoxyCodeLine{02045 \textcolor{comment}{//                        \}}}
\DoxyCodeLine{02046 \textcolor{comment}{//                        if (!flag) \{}}
\DoxyCodeLine{02047 \textcolor{comment}{//                            diff += result[i];}}
\DoxyCodeLine{02048 \textcolor{comment}{//                            info = j;}}
\DoxyCodeLine{02049 \textcolor{comment}{//                            if (mode != 0)}}
\DoxyCodeLine{02050 \textcolor{comment}{//                                flag = diff >= ds -\/ stop;}}
\DoxyCodeLine{02051 \textcolor{comment}{//}}
\DoxyCodeLine{02052 \textcolor{comment}{//                            if (!result[i] \&\& !flag) \{}}
\DoxyCodeLine{02053 \textcolor{comment}{//                                for (index row = 0; row < ds -\/ i -\/ 1; row++) \{}}
\DoxyCodeLine{02054 \textcolor{comment}{//                                    for (index h = 0; h < dx; h++) \{}}
\DoxyCodeLine{02055 \textcolor{comment}{//                                        temp = row * dx + h;}}
\DoxyCodeLine{02056 \textcolor{comment}{//                                        sum = 0;}}
\DoxyCodeLine{02057 \textcolor{comment}{//                                        row\_n = (n * temp) -\/ ((temp * (temp + 1)) / 2);}}
\DoxyCodeLine{02058 \textcolor{comment}{//\#pragma omp simd reduction(+:sum)}}
\DoxyCodeLine{02059 \textcolor{comment}{//                                        for (index col = n\_dx\_q\_0; col < n\_dx\_q\_1; col++) \{}}
\DoxyCodeLine{02061 \textcolor{comment}{//                                            sum += R\_A[row\_n + col] * z\_x[col];}}
\DoxyCodeLine{02062 \textcolor{comment}{//                                        \}}}
\DoxyCodeLine{02063 \textcolor{comment}{//                                        R\_S[temp * ds + i] = sum;}}
\DoxyCodeLine{02064 \textcolor{comment}{//                                    \}}}
\DoxyCodeLine{02065 \textcolor{comment}{//                                \}}}
\DoxyCodeLine{02066 \textcolor{comment}{//                            \}}}
\DoxyCodeLine{02067 \textcolor{comment}{//                        \}}}
\DoxyCodeLine{02068 \textcolor{comment}{//                    \}}}
\DoxyCodeLine{02069 \textcolor{comment}{//                    for (index row = n\_dx\_q\_0; row < n\_dx\_q\_1; row++) \{}}
\DoxyCodeLine{02070 \textcolor{comment}{//                        z\_x[row] = z\_p[row];}}
\DoxyCodeLine{02071 \textcolor{comment}{//                    \}}}
\DoxyCodeLine{02072 \textcolor{comment}{                \}}}
\DoxyCodeLine{02073 \textcolor{comment}{            \}}}
\DoxyCodeLine{02074 \textcolor{comment}{        \}}}
\DoxyCodeLine{02075 \textcolor{comment}{        scalar run\_time2 = omp\_get\_wtime() -\/ run\_time;}}
\DoxyCodeLine{02076 \textcolor{comment}{\#pragma parallel omp cancellation point}}
\DoxyCodeLine{02077 \textcolor{comment}{\#pragma omp flush}}
\DoxyCodeLine{02078 \textcolor{comment}{        returnType<scalar, index> reT;}}
\DoxyCodeLine{02079 \textcolor{comment}{        if (mode == 0)}}
\DoxyCodeLine{02080 \textcolor{comment}{            reT = \{z\_B, run\_time2, diff\};}}
\DoxyCodeLine{02081 \textcolor{comment}{        else \{}}
\DoxyCodeLine{02082 \textcolor{comment}{            reT = \{z\_B, run\_time2, info\};}}
\DoxyCodeLine{02083 \textcolor{comment}{            cout << "diff:" << diff << ", ";}}
\DoxyCodeLine{02084 \textcolor{comment}{        \}}}
\DoxyCodeLine{02085 \textcolor{comment}{        return reT;}}
\DoxyCodeLine{02086 \textcolor{comment}{    \}}}
\DoxyCodeLine{02087 \textcolor{comment}{ */}}

\end{DoxyCode}
